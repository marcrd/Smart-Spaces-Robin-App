/** robin-js-sdk* http://getrobin.com/** Copyright (c) 2014 Robin Powered Inc.* Licensed under the Apache v2 license.* https://github.com/robinpowered/robin-js-sdk/blob/master/LICENSE**/!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Robin=e()}}(function(){var define,module,exports;return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t){var r,n=e("util"),i=e("../util"),o=e("./base"),s=e("./requestBase");r={accounts:e("./modules/accounts"),apps:e("./modules/apps"),auth:e("./modules/auth"),channels:e("./modules/channels"),deviceManifests:e("./modules/devicemanifests"),devices:e("./modules/devices"),identifiers:e("./modules/identifiers"),me:e("./modules/me"),organizations:e("./modules/organizations"),events:e("./modules/events"),locations:e("./modules/locations"),spaces:e("./modules/spaces")},t.exports=function(){function e(t,r,n){if(!t)throw new TypeError("The access token is missing or malformed");e.super_.apply(this,arguments),this.setAccessToken(t),this.setupCore(r),this.setupPlaces(n),this.loadApiModules()}return n.inherits(e,o),e.prototype.setupCore=function(e){var t;if(!e)throw new TypeError("The url of the core API is not present or malformed");t=new s,this.Core=i.applyScope(t,this),this.Core.setBaseUrl(e)},e.prototype.setupPlaces=function(e){var t;if(!e)throw new TypeError("The url of the places API is not present or malformed");t=new s,this.Places=i.applyScope(t,this),this.Places.setBaseUrl(e)},e.prototype.loadApiModules=function(){var e,t,n;for(n in r)e=r[n],t=i.cloneObject(e),this[n]=i.applyScope(t,this)},e.prototype.GET=function(e,t){return this.Core.GET(e,t)},e.prototype.HEAD=function(e,t){return this.Core.HEAD(e,t)},e.prototype.POST=function(e,t){return this.Core.POST(e,t)},e.prototype.PUT=function(e,t){return this.Core.PUT(e,t)},e.prototype.PATCH=function(e,t){return this.Core.PATCH(e,t)},e.prototype.DELETE=function(e,t){return this.Core.DELETE(e,t)},e.prototype.OPTIONS=function(e,t){return this.Core.OPTIONS(e,t)},e.prototype.all=function(e,t){return this.Core.all(e,t)},e}.call(this)},{"../util":24,"./base":2,"./modules/accounts":4,"./modules/apps":5,"./modules/auth":6,"./modules/channels":7,"./modules/devicemanifests":8,"./modules/devices":9,"./modules/events":10,"./modules/identifiers":11,"./modules/locations":12,"./modules/me":13,"./modules/organizations":14,"./modules/spaces":15,"./requestBase":16,util:65}],2:[function(e,t){var r=e("bluebird");t.exports=function(){function e(){}return e.prototype.setAccessToken=function(e){e&&(this._accessToken=e)},e.prototype.getAccessToken=function(){return this._accessToken?this._accessToken:void 0},e.prototype.setRelayIdentifier=function(e){e&&(this._relayIdentifier=e)},e.prototype.getRelayIdentifier=function(){return this._relayIdentifier?this._relayIdentifier:void 0},e.prototype.rejectRequest=function(e){return r.reject(e)},e.prototype.constructPath=function(){var e,t,r,n=[];for(t in arguments)r=arguments[t],r&&n.push(r);return e=n.join("/"),e?"/"!==e.slice(0,1)&&(e="/"+e):e="/",e},e}.apply(this,arguments)},{bluebird:27}],3:[function(e,t){var r=e("./api");t.exports=r},{"./api":1}],4:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n;return e?(n=this.constructPath(r.ACCOUNTS,e),this.Core.GET(n,t)):this.rejectRequest("Bad Request: An account id or slug must be supplied for this operation")}}},{"../../util":24}],5:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.APPS,e);return this.Core.GET(n,t)},update:function(e,t){var n;return e&&t?(n=this.constructPath(r.APPS,e),this.Core.POST(n,t)):this.rejectRequest("Bad Request: An app id or slug and a data object are required.")},"delete":function(e){var t;return e?(t=this.constructPath(r.APPS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: An app id or slug is required.")}}},{"../../util":24}],6:[function(e,t){var r=e("../../util").constants;t.exports={getAccessTokenInfo:function(e){var t=this.constructPath(r.AUTH);return this.Core.GET(t,e)}}},{"../../util":24}],7:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.CHANNELS,e);return this.Core.GET(n,t)},create:function(e){var t;return e?(t=this.constructPath(r.CHANNELS),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required.")},update:function(e,t){var n;return e&&t?(n=this.constructPath(r.CHANNELS,e),this.Core.PATCH(n,t)):this.rejectRequest("Bad Request: A channel identifier and a data object are required.")},"delete":function(e){var t;return e?(t=this.constructPath(r.CHANNELS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: A channel identifier is required.")},data:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.CHANNELS,e,r.DATA,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A channel identifier is required.")},add:function(e,t){var n;return e?(n=this.constructPath(r.CHANNELS,e,r.DATA),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A channel identifier is required.")},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.CHANNELS,e,r.DATA,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: A channel identifier and a data point identifier are required.")}},triggers:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.CHANNELS,e,r.TRIGGERS,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A channel identifier is required.")},add:function(e,t){var n;return e?(n=this.constructPath(r.CHANNELS,e,r.TRIGGERS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A channel identifier and a data object are required.")},update:function(e,t,n){var i,o;return e&&t&&n?(i=this.constructPath(r.CHANNELS,e,r.TRIGGERS,t),this.Core.PATCH(i,n)):(o="Bad Request: A channel identifier, a feed identifier and a trigger object are required.",this.rejectRequest(o))},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.CHANNELS,e,r.TRIGGERS,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: A channel identifier and a trigger identifier are required.")}}}},{"../../util":24}],8:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.DEVICE_MANIFESTS,e);return this.Core.GET(n,t)},create:function(e){var t;return e?(t=this.constructPath(r.DEVICE_MANIFESTS),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")},update:function(e,t){var n;return e&&t?(n=this.constructPath(r.DEVICE_MANIFESTS,e),this.Core.PATCH(n,t)):this.rejectRequest("Bad Request: A device manifest identifier and a data object are required.")},"delete":function(e){var t;return e?(t=this.constructPath(r.DEVICE_MANIFESTS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: A device manifest identifier is required.")},feeds:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.DEVICE_MANIFESTS,e,r.FEEDS,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A device manifest identifier is required.")},add:function(e,t){var n;return e?(n=this.constructPath(r.DEVICE_MANIFESTS,e,r.FEEDS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A device manifest identifier and a data object are required.")},update:function(e,t,n){var i,o;return e&&t&&n?(i=this.constructPath(r.DEVICE_MANIFESTS,e,r.FEEDS,t),this.Core.PATCH(i,n)):(o="Bad Request: A device manifest identifier, a feed identifier and a data object are required.",this.rejectRequest(o))},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.DEVICE_MANIFESTS,e,r.FEEDS,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: A device manifest identifier and a feed identifier are required.")}},devices:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.DEVICE_MANIFESTS,e,r.DEVICES,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A device manifest identifier is required.")}}}},{"../../util":24}],9:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.DEVICES,e);return this.Core.GET(n,t)},create:function(e){var t;return e?(t=this.constructPath(r.DEVICES),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")},update:function(e,t){var n;return e&&t?(n=this.constructPath(r.DEVICES,e),this.Core.PATCH(n,t)):this.rejectRequest("Bad Request: A device identifier and a data object are required.")},"delete":function(e){var t;return e?(t=this.constructPath(r.DEVICES,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: A device identifier is required.")},identifiers:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.DEVICES,e,r.IDENTIFIERS,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A device identifier is required.")},create:function(e,t){var n;return e?(n=this.constructPath(r.DEVICES,e,r.IDENTIFIERS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A device identifier and a data object are required.")},add:function(e,t,n){var i;return e?(i=this.constructPath(r.DEVICES,e,r.IDENTIFIERS,t),this.Core.PATCH(i,n)):this.rejectRequest("Bad Request: A device identifier, an identifier id and a data object are required.")},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.DEVICES,e,r.IDENTIFIERS,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: A device identifier and an identifier id are required.")}},channels:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.DEVICES,e,r.CHANNELS,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A device identifier is required.")},create:function(e,t){var n;return e?(n=this.constructPath(r.DEVICES,e,r.CHANNELS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A device identifier and a data object are required.")},update:function(e,t,n){var i,o;return e&&t&&n?(i=this.constructPath(r.DEVICES,e,r.CHANNELS,t),this.Core.PATCH(i,n)):(o="Bad Request: A device identifier, a feed identifier and a data object are required.",this.rejectRequest(o))},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.DEVICES,e,r.CHANNELS,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: A device identifier and a channel identifier are required.")}},spaces:{get:function(e,t){var n;return e?(n=this.constructPath(r.DEVICES,e,r.SPACES),this.Core.GET(n,t)):this.rejectRequest("Bad Request: A device identifier is required")}}}},{"../../util":24}],10:[function(e,t){var r=e("../../util").constants;t.exports={create:function(e){var t;return e?(t=this.constructPath(r.EVENTS),this.Places.POST(t,e)):this.rejectRequest("Bad Request: A data object is required.")}}},{"../../util":24}],11:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.IDENTIFIERS,e);return this.Core.GET(n,t)},"delete":function(e){if(e){var t=this.constructPath(r.IDENTIFIERS,e);return this.Core.DELETE(t)}return this.rejectRequest("Bad request: An identifier URN is required.")}}},{"../../util":24}],12:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.LOCATIONS,e);return this.Core.GET(n,t)},update:function(e,t){var n;return e&&t?(n=this.constructPath(r.LOCATIONS,e),this.Core.PATCH(n,t)):this.rejectRequest("Bad Request. A location identifier and a data object are required")},"delete":function(e){var t;return e?(t=this.constructPath(r.LOCATIONS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: A location identifier is required.")},spaces:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.LOCATIONS,e,r.SPACES,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A location identifier is required.")},add:function(e,t){var n;return e?(n=this.constructPath(r.LOCATIONS,e,r.SPACES),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A location identifier is required.")}},presence:{get:function(e,t){var n;return e?(n=this.constructPath(r.LOCATIONS,e,r.PRESENCE),this.Core.GET(n,t)):this.rejectRequest("Bad Request: A location identifier is required.")}}}},{"../../util":24}],13:[function(e,t){var r=e("../../util").constants;t.exports={get:function(){var e=this.constructPath(r.ME);return this.Core.GET(e)},update:function(e){if(e){var t=this.constructPath(r.ME);return this.Core.PATCH(t,e)}return this.rejectRequest("Bad Request. A data object is required")},updateEmail:function(e){if(e){var t=this.constructPath(r.ME,r.EMAIL);return this.Core.PATCH(t,e)}return this.rejectRequest("Bad Request. A data object is required")},changePassword:function(e){if(e){var t=this.constructPath(r.ME,r.PASSWORD);return this.Core.PATCH(t,e)}return this.rejectRequest("Bad Request. A data object is required")},"delete":function(){var e=this.constructPath(r.ME);return this.Core.DELETE(e)},organizations:{get:function(){var e=this.constructPath(r.ME,r.ORGANIZATIONS);return this.Core.GET(e)}},authorizations:{get:function(){var e=this.constructPath(r.ME,r.AUTHORIZATIONS);return this.Core.GET(e)},add:function(e,t,n){var i;return e&&t&&n?(i=this.constructPath(r.ME,r.AUTHORIZATIONS,e,t),this.Core.POST(i,n)):this.rejectRequest("Bad Request: Authorization type and identifier and data payload are required")},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.ME,r.AUTHORIZATIONS,e,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: Authorization type and identifier are both required")}},devices:{get:function(){var e=this.constructPath(r.ME,r.DEVICES);return this.Core.GET(e)},add:function(e){var t;return e?(t=this.constructPath(r.ME,r.DEVICES),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")}},projects:{get:function(){var e=this.constructPath(r.ME,r.PROJECTS);return this.Core.GET(e)},add:function(e){var t;return e?(t=this.constructPath(r.ME,r.PROJECTS),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")}},channels:{get:function(){var e=this.constructPath(r.ME,r.CHANNELS);return this.Core.GET(e)},create:function(e){var t;return e?(t=this.constructPath(r.ME,r.CHANNELS),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")},add:function(e){var t;return e?(t=this.constructPath(r.ME,r.CHANNELS,e),this.Core.PUT(t)):this.rejectRequest("Bad Request: A channel identifier is required")},"delete":function(e){var t;return e?(t=this.constructPath(r.ME,r.CHANNELS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: A channel identifier is required")}},identifiers:{get:function(){var e=this.constructPath(r.ME,r.IDENTIFIERS);return this.Core.GET(e)},create:function(e){var t;return e?(t=this.constructPath(r.ME,r.IDENTIFIERS),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")},add:function(e){var t;return e?(t=this.constructPath(r.ME,r.IDENTIFIERS,e),this.Core.PUT(t)):this.rejectRequest("Bad Request: An identifier urn is required")},"delete":function(e){var t;return e?(t=this.constructPath(r.ME,r.IDENTIFIERS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: An identifier urn is required")}}}},{"../../util":24}],14:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.ORGANIZATIONS,e);return this.Core.GET(n,t)},create:function(e){var t;return e?(t=this.constructPath(r.ORGANIZATIONS),this.Core.POST(t,e)):this.rejectRequest("Bad Request: A data object is required")},update:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e),this.Core.PATCH(n,t)):this.rejectRequest("Bad Request: An organization id or slug and a data object are required.")},"delete":function(e){var t;return e?(t=this.constructPath(r.ORGANIZATIONS,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: An organization id or slug is required.")},users:{get:function(e,t){var n;return e?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS,t),this.Core.GET(n)):this.rejectRequest("Bad Request: An organization id or slug is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS,t),this.Core.PUT(n)):this.rejectRequest("Bad Request: An organization id or slug and a user id is required.")},update:function(e,t,n){var i,o;return e&&t&&n?(i=this.constructPath(r.ORGANIZATIONS,e,r.USERS,t),this.Core.PATCH(i,n)):(o="Bad Request: An organization id or slug and a user id and data is required.",this.rejectRequest(o))},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: An organization id or slug and a user id is required.")}},managers:{get:function(e){var t;return e?(t=this.constructPath(r.ORGANIZATIONS,e,r.MANAGERS),this.Core.GET(t)):this.rejectRequest("Bad Request: An organization id or slug is required.")}},apps:{get:function(e,t){var n;return e?(n=this.constructPath(r.ORGANIZATIONS,e,r.APPS),this.Core.GET(n,t)):this.rejectRequest("Bad Request: An organization id or slug is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.APPS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: An organization id or slug and a data object is required.")}},devices:{get:function(e,t){var n;return e?(n=this.constructPath(r.ORGANIZATIONS,e,r.DEVICES),this.Core.GET(n,t)):this.rejectRequest("Bad Request: An organization id or slug is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.DEVICES),this.Core.POST(n,t)):this.rejectRequest("Bad Request: An organization id or slug and a data object is required.")}},projects:{get:function(e,t){var n;return e?(n=this.constructPath(r.ORGANIZATIONS,e,r.PROJECTS),this.Core.GET(n,t)):this.rejectRequest("Bad Request: An organization id or slug is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.PROJECTS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: An organization id or slug and a data object is required.")}},channels:{get:function(e,t){var n;return e?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS),this.Core.GET(n,t)):this.rejectRequest("Bad Request: An organization id or slug is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS,t),this.Core.PUT(n)):this.rejectRequest("Bad Request: An organization id or slug and a channel id is required.")},create:function(e,t){var n,i;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS),this.Core.POST(n,t)):(i="Bad Request: An organization id or slug and data is required.",this.rejectRequest(i))},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.USERS,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: An organization id or slug and a channel id is required.")}},locations:{get:function(e,t){var n;return e?(n=this.constructPath(r.ORGANIZATIONS,e,r.LOCATIONS),this.Core.GET(n,t)):this.rejectRequest("Bad Request: An organization id or slug is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.ORGANIZATIONS,e,r.LOCATIONS),this.Core.POST(n,t)):this.rejectRequest("Bad Request: An organization id or slug and a data object is required.")}}}},{"../../util":24}],15:[function(e,t){var r=e("../../util").constants;t.exports={get:function(e,t){var n=this.constructPath(r.SPACES,e);return this.Core.GET(n,t)},update:function(e,t){var n;return t?(n=this.constructPath(r.SPACES,e),this.Core.PATCH(n,t)):this.rejectRequest("Bad Request: Space data is required")},"delete":function(e){var t;return e?(t=this.constructPath(r.SPACES,e),this.Core.DELETE(t)):this.rejectRequest("Bad Request: A space identifier is required")},devices:{get:function(e,t,n){var i;return e?(i=this.constructPath(r.SPACES,e,r.DEVICES,t),this.Core.GET(i,n)):this.rejectRequest("Bad Request: A space identifier is required.")},create:function(e,t){var n;return e&&t?(n=this.constructPath(r.SPACES,e,r.DEVICES),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A space identifier and device data are required")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.SPACES,e,r.DEVICES,t),this.Core.PUT(n)):this.rejectRequest("Bad Request: A space identifier and device identifier are required")},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.SPACES,e,r.DEVICES,t),this.Core.DELETE(n)):this.rejectRequest("Bad Request: A space identifier and device identifier are required")}},presence:{get:function(e,t){var n;return e?(n=this.constructPath(r.SPACES,e,r.PRESENCE),this.Core.GET(n,t)):this.rejectRequest("Bad Request: A space identifier is required.")},add:function(e,t){var n;return e&&t?(n=this.constructPath(r.SPACES,e,r.PRESENCE),this.Core.POST(n,t)):this.rejectRequest("Bad Request: A space identifier and data object are required")},"delete":function(e,t){var n;return e&&t?(n=this.constructPath(r.SPACES,e,r.PRESENCE),this.Core.DELETE(n,t)):this.rejectRequest("Bad Request: A space identifier and data object are required")}}}},{"../../util":24}],16:[function(e,t){var r=e("bluebird"),n=e("../error"),i=e("../util"),o=r.promisify(e("request"));t.exports=function(){function e(){var e,t=this;this.getBaseUrl=function(){return e?e:void 0},this.setBaseUrl=function(t){e=t},this.isSuccess=function(e){var t=function(e){return e>=200&&300>e};return e&&t(e.statusCode)?!0:!1},this.buildOptions=function(e,r,n){var i,o=this.getAccessToken(),s=this.getRelayIdentifier(),a=t.getBaseUrl(),u=t.constructUrl(a,e);if(i={uri:u,method:r,headers:{}},!o)throw new Error("The required Access Token is missing or malformed");return i.headers.Authorization="Access-Token "+o,s&&(i.headers["Relay-Identifier"]=s),r&&"GET"===r.toUpperCase()?i.qs=n:i.json=n,i},this.constructUrl=function(e,t){return"/"===e.slice(-1)&&"/"===t.slice(0,1)?e.slice(0,-1)+t:"/"!==e.slice(-1)&&"/"!==t.slice(0,1)?e+"/"+t:e+t},this.sendRequest=function(e,r,i){var s=t.buildOptions(e,r,i),a=o(s).spread(function(o,s){var a,u={};try{a="string"==typeof s?JSON.parse(s):s}catch(c){throw new Error("An error occurred parsing the following response from the server: "+s)}if(u.body=a,t.isSuccess(o)){if(u.getData=function(){return u.body.data},u.isEmpty=function(){return 0===Object.getOwnPropertyNames(u.getData()).length},u.getDataLength=function(){var e=u.getData();return u.isEmpty()?0:e instanceof Array?e.length:1},"GET"===r&&u.body.paging){var h,l,f,d,p;h=u.body.paging.per_page,l=u.body.paging.page,f=1===l?l:l-1,d=l+1,p=function(n){var o;return o=n,function(){return i=void 0!==i&&i?i:{},i.page=o,i.per_page=h,t.sendRequest(e,r,i)}},u.nextPage=p(d),u.prevPage=p(f)}return u}throw new n.ApiError(u)});return a}}return e.prototype.GET=function(e,t){return this.sendRequest(e,"GET",t)},e.prototype.HEAD=function(e,t){return this.sendRequest(e,"HEAD",t)},e.prototype.POST=function(e,t){return this.sendRequest(e,"POST",t)},e.prototype.PUT=function(e,t){return this.sendRequest(e,"PUT",t)},e.prototype.PATCH=function(e,t){return this.sendRequest(e,"PATCH",t)},e.prototype.DELETE=function(e,t){return this.sendRequest(e,"DELETE",t)},e.prototype.OPTIONS=function(e,t){return this.sendRequest(e,"OPTIONS",t)},e.prototype.all=function(e,t){var n,o,s,a=[];if(i.isObject(e)){if(!(e instanceof r))throw new TypeError("Path must be a Promise Object or a String");o=e}else{if("string"!=typeof e)throw new TypeError("Path must be a Promise Object or a String");s=e,t&&t.per_page&&delete t.per_page,o=this.GET(s,t)}return(n=function(e){return e.then(function(e){var t=e.getData();if(!t)return r.resolve(a);if(i.isArray(t))Array.prototype.push.apply(a,t);else{if(!i.isObject(t))throw new Error("The server response was malformed");a.push(t)}return e.nextPage?n(e.nextPage()):r.resolve(a)}.bind(this)).catch(function(e){throw e})})(o)},e}.call(this)},{"../error":17,"../util":24,bluebird:27,request:60}],17:[function(e,t){function r(e){r.super_.call(this),i.isObject(e)&&i.isObject(e.body)&&i.isObject(e.body.meta)?(this.status_code=e.body.meta.status_code,this.status=e.body.meta.status,this.message=e.body.meta.message,this.moreInfo=e.body.meta.more_info):this.message=e.toString()}var n=e("util"),i=e("./util");n.inherits(r,Error),t.exports.ApiError=r},{"./util":24,util:65}],18:[function(e,t){var r,n=e("util"),i=e("faye"),o=e("events").EventEmitter;i.Grammar.CHANNEL_NAME=new RegExp("^\\/(((([a-z]|[A-Z])|[0-9])|(\\:|\\-|\\_|\\!|\\~|\\(|\\)|\\$|\\@)))+(\\/(((([a-z]|[A-Z])|[0-9])|(\\:|\\-|\\_|\\!|\\~|\\(|\\)|\\$|\\@)))+)*$"),i.Grammar.CHANNEL_PATTERN=new RegExp("^(\\/(((([a-z]|[A-Z])|[0-9])|(\\:|\\-|\\_|\\!|\\~|\\(|\\)|\\$|\\@)))+)*\\/\\*{1,2}$"),r=function(e){function t(){}return n.inherits(t,e),t.prototype.setGridUrl=function(e){e&&(this._gridUrl=e)},t.prototype.getGridUrl=function(){return this._gridUrl?this._gridUrl:void 0},t.prototype.setAccessToken=function(e){e&&(this._accessToken=e)},t.prototype.getAccessToken=function(){return this._accessToken?this._accessToken:void 0},t.prototype.setRelayIdentifier=function(e){e&&(this._relayIdentifier=e)},t.prototype.getRelayIdentifier=function(){return this._relayIdentifier?this._relayIdentifier:void 0},t.prototype.setupGridMessageHandler=function(){var e,t,r=this.getGridUrl();if(!r)throw new Error("A Grid url is required");this.gridClient=new i.Client(r),this.gridClient.on("transport:down",function(){this.emit("error","Grid transport is down.")}.bind(this)),e=function(e,t){try{var r,n,i,o,s,a=e.channel;e.data&&(r=a.replace(/^\//,"").split("/"),n=r[0],i=r[1],o=r[2],s=e.data,e.data={data:s},e.data.ext={channel:a,endpoint:n,identifier:i,type:o}),t(e)}catch(u){e.error=u,t(e)}}.bind(this),t=function(e,t){e.ext||(e.ext={}),e.ext.accessToken=this.getAccessToken(),e.ext.relayIdentifier=this.getRelayIdentifier(),t(e)}.bind(this),this.gridClient.addExtension({incoming:e,outgoing:t})},t}.apply(this,[o]),t.exports=r},{events:61,faye:66,util:65}],19:[function(e,t){t.exports=function(){function t(e){try{t.super_.apply(this,arguments),n.__copyProperties(this,e),this.validate(),this.connectionStub="/"+this.endpoint+"/"+this.identifier}catch(r){throw r}}var r=e("util"),n=e("../util"),i=e("events").EventEmitter;return r.inherits(t,i),t.prototype.validate=function(){if(!this.endpoint)throw new Error("The supplied endpoint is invalid or malformed.");if(!this.identifier)throw new Error("The supplied identifier is invalid or malformed.")},t.prototype.listen=function(e){var t=this.connectionStub+"/*";this.connection=this.gridClient.subscribe(t,this.messageCallback.bind(this)),this.connection.then(function(t){e&&e(null,t)},function(t){e&&e(t)})},t.prototype.messageCallback=function(e){this.emit(e.ext.type,e.data)},t.prototype.stop=function(e){this.connection?(this.connection.cancel(),e&&e(null)):e&&e("No connection found")},t.prototype.send=function(e,t,r){var n,i=this.connectionStub+"/"+e;n=this.gridClient.publish(i,t),n.then(function(e){r&&r(null,e)},function(e){r&&r(e)})},t}.call(this)},{"../util":24,events:61,util:65}],20:[function(e,t){var r,n=e("./base"),i=e("util");r={channel:e("./modules/channel"),device:e("./modules/device")},t.exports=function(){function e(t,r){e.super_.apply(this,arguments),this.subscriptions={},this.setAccessToken(t),this.setGridUrl(r),this.setupGridMessageHandler(),this.loadConnectionModules()}return i.inherits(e,n),e.prototype.loadConnectionModules=function(){var e,t;for(e in r)t=r[e],this[e]=new t(this)},e}.call()},{"./base":18,"./modules/channel":22,"./modules/device":23,util:65}],21:[function(e,t){var r=e("./grid");t.exports=r},{"./grid":20}],22:[function(e,t){var r=e("../connection"),n=e("util"),i=e("../../util");t.exports=function(){function e(e){if(!e)throw new Error("An instance of the Grid is required");i.__copyProperties(this,e)}return n.inherits(e,r),e.prototype.connect=function(e){if(e)return this.endpoint="channels",this.identifier=e,new r(this);throw new TypeError("An the identifier of the entity to which you wish to connect must be supplied")},e}.call(this)},{"../../util":24,"../connection":19,util:65}],23:[function(e,t){var r=e("../connection"),n=e("util"),i=e("../../util");t.exports=function(){function e(e){if(!e)throw new Error("An instance of the Grid is required");i.__copyProperties(this,e)}return n.inherits(e,r),e.prototype.connect=function(e){if(e)return this.endpoint="devices",this.identifier=e,new r(this);throw new TypeError("An the identifier of the entity to which you wish to connect must be supplied")},e}.call(this)},{"../../util":24,"../connection":19,util:65}],24:[function(e,t){var r=function(e,t){if(t!==e)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};t.exports.__copyProperties=r;var n=function(e){return e&&"function"==typeof e};t.exports.isFunction=n;var i=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)};t.exports.isObject=i;var o=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===toString.call(e)||!1};t.exports.isArray=o;var s=function(e,t){var r,o;for(r in e)e.hasOwnProperty(r)&&(o=e[r],n(o)?e[r]=o.bind(t):i(o)&&s(o,t));return e};t.exports.applyScope=s;var a=function(e){var t;return null!==e&&i(e)?(t=e.constructor(),r(t,e),t):e};t.exports.cloneObject=a;var u={ACCOUNT:"account",ACCOUNTS:"accounts",APP:"app",APPS:"apps",AUTH:"auth",AUTHORIZATIONS:"authorizations",CHANNELS:"channels",DATA:"data",DEVICE_MANIFESTS:"device-manifests",DEVICES:"devices",EMAIL:"email",EVENTS:"events",FEEDS:"feeds",IDENTIFIERS:"identifiers",LOCATIONS:"locations",MANAGERS:"managers",ME:"me",ORGANIZATIONS:"organizations",PASSWORD:"password",PERSONAS:"personas",PRESENCE:"presence",PROJECTS:"projects",SPACES:"spaces",TRIGGERS:"triggers",USERS:"users",VALID_APP_ENDPOINT_NAMES:["api","apps","grid"],VALID_APP_MAPPING:{core:"api",grid:"grid",places:"apps"},VALID_APP_NAMES:["core","places","grid"],VALID_ENVS:["test","staging","production"]};t.exports.constants=u;var c=function(e,t){var r="",n="",i="v1.0",o=".robinpowered.com",s="https://";if(!e)throw new TypeError("`robinType` is a required parameter");if(-1===u.VALID_APP_ENDPOINT_NAMES.indexOf(e))throw new TypeError("Invalid value for `robinType`. Value can be one of: "+u.VALID_APP_ENDPOINT_NAMES.join(","));if(t&&"production"!==t){if(-1===u.VALID_ENVS.indexOf(t))throw new TypeError(t+" is not a valid Robin environment");n="."+t,"test"===t&&(s="http://")}return r=s+e+n+o+"/"+i};t.exports.constructRobinUrl=c;var h=function(e){var t,r,n,o={};if(e)if("string"==typeof e)t=e.toLowerCase();else{if(!i(e))throw new TypeError("Argument must be object, string null or undefined.");if(e.env){if("string"!=typeof e.env)throw new TypeError("The `env` property of the options object must be a string");if(-1===u.VALID_ENVS.indexOf(e.env.toLowerCase()))throw new TypeError("Environment name is invalid.");t=e.env.toLowerCase()}if(e.urls){if(!i(e.urls))throw new TypeError("The urls property of the options object must be an object");for(n in e.urls)if(e.urls.hasOwnProperty(n)){if(-1===u.VALID_APP_NAMES.indexOf(n.toLowerCase()))throw new TypeError(n+" is not a valid robin app name");o[n.toLowerCase()]=e.urls[n]}}}for(r in u.VALID_APP_MAPPING)o[r]||(o[r]=c(u.VALID_APP_MAPPING[r],t));return o};t.exports.buildRobinUrls=h},{}],25:[function(e,t){"use strict";t.exports=function(e){function t(e){var t=new r(e),n=t.promise();return n.isRejected()?n:(t.setHowMany(1),t.setUnwrap(),t.init(),n)}var r=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],26:[function(e,t){(function(r){"use strict";function n(){this._isTickUsed=!1,this._schedule=i,this._length=0,this._lateBuffer=new o(16),this._functionBuffer=new o(65536);var e=this;this.consumeFunctionBuffer=function(){e._consumeFunctionBuffer()}}var i=e("./schedule.js"),o=e("./queue.js"),s=e("./util.js").errorObj,a=e("./util.js").tryCatch1,u="undefined"!=typeof r?r:void 0;n.prototype.haveItemsQueued=function(){return this._length>0},n.prototype.invokeLater=function(e,t,r){void 0===u||null==u.domain||e.domain||(e=u.domain.bind(e)),this._lateBuffer.push(e,t,r),this._queueTick()
},n.prototype.invoke=function(e,t,r){void 0===u||null==u.domain||e.domain||(e=u.domain.bind(e));var n=this._functionBuffer;n.push(e,t,r),this._length=n.length(),this._queueTick()},n.prototype._consumeFunctionBuffer=function(){for(var e=this._functionBuffer;e.length()>0;){var t=e.shift(),r=e.shift(),n=e.shift();t.call(r,n)}this._reset(),this._consumeLateBuffer()},n.prototype._consumeLateBuffer=function(){for(var e=this._lateBuffer;e.length()>0;){var t=e.shift(),r=e.shift(),n=e.shift(),i=a(t,r,n);if(i===s){if(this._queueTick(),null==t.domain)throw i.e;t.domain.emit("error",i.e)}}},n.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},n.prototype._reset=function(){this._isTickUsed=!1,this._length=0},t.exports=new n}).call(this,e("FWaASH"))},{"./queue.js":49,"./schedule.js":52,"./util.js":59,FWaASH:63}],27:[function(e,t){"use strict";var r=e("./promise.js")();t.exports=r},{"./promise.js":44}],28:[function(e,t){"use strict";var r=Object.create;if(r){var n=r(null),i=r(null);n[" size"]=i[" size"]=0}t.exports=function(t){function r(e){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,e))}function o(e){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))}function s(e,t,r){var n=r[e];if("function"!=typeof n){if(!p(e))return null;if(n=t(e),r[e]=n,r[" size"]++,r[" size"]>512){for(var i=Object.keys(r),o=0;256>o;++o)delete r[i[o]];r[" size"]=i.length-256}}return n}function a(e){return s(e,r,n)}function u(e){return s(e,o,i)}function c(e){return e[this.pop()].apply(e,this)}function h(e){return e[this]}function l(e){return e[this]}var f=e("./util.js"),d=f.canEvaluate,p=f.isIdentifier;t.prototype.call=function(e){for(var t=arguments.length,r=new Array(t-1),n=1;t>n;++n)r[n-1]=arguments[n];if(d){var i=a(e);if(null!==i)return this._then(i,void 0,void 0,r,void 0)}return r.push(e),this._then(c,void 0,void 0,r,void 0)},t.prototype.get=function(e){var t,r="number"==typeof e;if(r)t=l;else if(d){var n=u(e);t=null!==n?n:h}else t=h;return this._then(t,void 0,void 0,e,void 0)}}},{"./util.js":59}],29:[function(e,t){"use strict";t.exports=function(t,r){var n=e("./errors.js"),i=n.canAttach,o=e("./async.js"),s=n.CancellationError;t.prototype._cancel=function(e){if(!this.isCancellable())return this;for(var t,r=this;void 0!==(t=r._cancellationParent)&&t.isCancellable();)r=t;r._attachExtraTrace(e),r._rejectUnchecked(e)},t.prototype.cancel=function(e){return this.isCancellable()?(e=void 0!==e?i(e)?e:new Error(e+""):new s,o.invokeLater(this._cancel,this,e),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var e=new t(r);return e._propagateFrom(this,6),e._follow(this),e._unsetCancellable(),e},t.prototype.fork=function(e,t,r){var n=this._then(e,t,r,void 0,void 0);return n._setCancellable(),n._cancellationParent=void 0,n}}},{"./async.js":26,"./errors.js":34}],30:[function(e,t){"use strict";t.exports=function(){function t(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(t))try{var i=JSON.stringify(e);t=i}catch(o){}0===t.length&&(t="(empty array)")}return"(<"+r(t)+">, no stack trace)"}function r(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function n(e,t){this.captureStackTrace(n,t)}var i=e("./util.js").inherits,o=e("./es5.js").defineProperty,s=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),a=null,u=null;i(n,Error),n.prototype.captureStackTrace=function(e,t){c(this,e,t)},n.possiblyUnhandledRejection=function(e){if("object"==typeof console){var t;if("object"==typeof e||"function"==typeof e){var r=e.stack;t="Possibly unhandled "+u(r,e)}else t="Possibly unhandled "+String(e);"function"==typeof console.error||"object"==typeof console.error?console.error(t):("function"==typeof console.log||"object"==typeof console.log)&&console.log(t)}},n.combine=function(e,t){for(var r=e.length-1,n=t.length-1;n>=0;--n){var i=t[n];if(e[r]!==i)break;e.pop(),r--}e.push("From previous event:");for(var o=e.concat(t),u=[],n=0,c=o.length;c>n;++n)s.test(o[n])&&a.test(o[n])||n>0&&!a.test(o[n])&&"From previous event:"!==o[n]||u.push(o[n]);return u},n.protectErrorMessageNewlines=function(e){for(var t=0;t<e.length&&!a.test(e[t]);++t);if(!(1>=t)){for(var r=[],n=0;t>n;++n)r.push(e.shift());e.unshift(r.join("\x00"))}},n.isSupported=function(){return"function"==typeof c};var c=function h(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){a=/^\s*at\s*/,u=function(e,r){return"string"==typeof e?e:void 0!==r.name&&void 0!==r.message?r.name+". "+r.message:t(r)};var e=Error.captureStackTrace;return function(t,r){e(t,r)}}var r=new Error;if("string"==typeof r.stack&&"function"==typeof"".startsWith&&r.stack.startsWith("stackDetection@")&&"stackDetection"===h.name){o(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),a=/@/;var n=/[@\n]/;return u=function(e,r){return"string"==typeof e?r.name+". "+r.message+"\n"+e:void 0!==r.name&&void 0!==r.message?r.name+". "+r.message:t(r)},function(e){for(var t=(new Error).stack,r=t.split(n),i=r.length,o="",s=0;i>s;s+=2)o+=r[s],o+="@",o+=r[s+1],o+="\n";e.stack=o}}return u=function(e,r){return"string"==typeof e?e:"object"!=typeof r&&"function"!=typeof r||void 0===r.name||void 0===r.message?t(r):r.name+". "+r.message},null}();return n}},{"./es5.js":36,"./util.js":59}],31:[function(e,t){"use strict";t.exports=function(t){function r(e,t,r){this._instances=e,this._callback=t,this._promise=r}function n(e,t){var r={},n=s(e,r,t);if(n===a)return n;var i=u(r);return i.length?(a.e=new c("Catch filter must inherit from Error or be a simple predicate function"),a):n}var i=e("./util.js"),o=e("./errors.js"),s=i.tryCatch1,a=i.errorObj,u=e("./es5.js").keys,c=o.TypeError;return r.prototype.doFilter=function(e){for(var r=this._callback,i=this._promise,u=i._boundTo,c=0,h=this._instances.length;h>c;++c){var l=this._instances[c],f=l===Error||null!=l&&l.prototype instanceof Error;if(f&&e instanceof l){var d=s(r,u,e);return d===a?(t.e=d.e,t):d}if("function"==typeof l&&!f){var p=n(l,e);if(p===a){var _=o.canAttach(a.e)?a.e:new Error(a.e+"");this._promise._attachExtraTrace(_),e=a.e;break}if(p){var d=s(r,u,e);return d===a?(t.e=d.e,t):d}}}return t.e=e,t},r}},{"./errors.js":34,"./es5.js":36,"./util.js":59}],32:[function(e,t){"use strict";var r=e("./util.js"),n=r.isPrimitive,i=r.wrapsPrimitiveReceiver;t.exports=function(e){var t=function(){return this},r=function(){throw this},o=function(e,t){return 1===t?function(){throw e}:2===t?function(){return e}:void 0};e.prototype["return"]=e.prototype.thenReturn=function(e){return i&&n(e)?this._then(o(e,2),void 0,void 0,void 0,void 0):this._then(t,void 0,void 0,e,void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(e){return i&&n(e)?this._then(o(e,1),void 0,void 0,void 0,void 0):this._then(r,void 0,void 0,e,void 0)}}},{"./util.js":59}],33:[function(e,t){"use strict";t.exports=function(e,t){var r=e.reduce;e.prototype.each=function(e){return r(this,e,null,t)},e.each=function(e,n){return r(e,n,null,t)}}},{}],34:[function(e,t){"use strict";function r(e){try{d(e,"isOperational",!0)}catch(t){}}function n(e){return null==e?!1:e instanceof a||e.isOperational===!0}function i(e){return e instanceof Error}function o(e){return i(e)}function s(e,t){function r(n){return this instanceof r?(this.message="string"==typeof n?n:t,this.name=e,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new r(n)}return f(r,Error),r}function a(e){this.name="OperationalError",this.message=e,this.cause=e,this.isOperational=!0,e instanceof Error?(this.message=e.message,this.stack=e.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var u,c,h=e("./es5.js").freeze,l=e("./util.js"),f=l.inherits,d=l.notEnumerableProp,p=s("CancellationError","cancellation error"),_=s("TimeoutError","timeout error"),v=s("AggregateError","aggregate error");try{u=TypeError,c=RangeError}catch(y){u=s("TypeError","type error"),c=s("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<g.length;++m)"function"==typeof Array.prototype[g[m]]&&(v.prototype[g[m]]=Array.prototype[g[m]]);v.prototype.length=0,v.prototype.isOperational=!0;var E=0;v.prototype.toString=function(){var e=Array(4*E+1).join(" "),t="\n"+e+"AggregateError of:\n";E++,e=Array(4*E+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",i=n.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];n=i.join("\n"),t+=n+"\n"}return E--,t},f(a,Error);var b="__BluebirdErrorTypes__",j=Error[b];j||(j=h({CancellationError:p,TimeoutError:_,OperationalError:a,RejectionError:a,AggregateError:v}),d(Error,b,j)),t.exports={Error:Error,TypeError:u,RangeError:c,CancellationError:j.CancellationError,OperationalError:j.OperationalError,TimeoutError:j.TimeoutError,AggregateError:j.AggregateError,originatesFromRejection:n,markAsOriginatingFromRejection:r,canAttach:o}},{"./es5.js":36,"./util.js":59}],35:[function(e,t){"use strict";t.exports=function(t){function r(e){var r=new n(e),i=t.rejected(r),o=i._peekContext();return null!=o&&o._attachExtraTrace(r),i}var n=e("./errors.js").TypeError;return r}},{"./errors.js":34}],36:[function(e,t){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r};else{var n={}.hasOwnProperty,i={}.toString,o={}.constructor.prototype,s=function(e){var t=[];for(var r in e)n.call(e,r)&&t.push(r);return t},a=function(e,t,r){return e[t]=r.value,e},u=function(e){return e},c=function(e){try{return Object(e).constructor.prototype}catch(t){return o}},h=function(e){try{return"[object Array]"===i.call(e)}catch(t){return!1}};t.exports={isArray:h,keys:s,defineProperty:a,freeze:u,getPrototypeOf:c,isES5:r}}},{}],37:[function(e,t){"use strict";t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,i){return r(e,n,i,t)}}},{}],38:[function(e,t){"use strict";t.exports=function(t,r,n){function i(){return this}function o(){throw this}function s(e){return function(){return e}}function a(e){return function(){throw e}}function u(e,t,r){var n;return n=f&&d(t)?r?s(t):a(t):r?i:o,e._then(n,p,void 0,t,void 0)}function c(e){var i=this.promise,o=this.handler,s=i._isBound()?o.call(i._boundTo):o();if(void 0!==s){var a=n(s,void 0);if(a instanceof t)return u(a,e,i.isFulfilled())}return i.isRejected()?(r.e=e,r):e}function h(e){var r=this.promise,i=this.handler,o=r._isBound()?i.call(r._boundTo,e):i(e);if(void 0!==o){var s=n(o,void 0);if(s instanceof t)return u(s,e,!0)}return e}var l=e("./util.js"),f=l.wrapsPrimitiveReceiver,d=l.isPrimitive,p=l.thrower;t.prototype._passThroughHandler=function(e,t){if("function"!=typeof e)return this.then();var r={promise:this,handler:e};return this._then(t?c:h,t?c:void 0,void 0,r,void 0)},t.prototype.lastly=t.prototype["finally"]=function(e){return this._passThroughHandler(e,!0)},t.prototype.tap=function(e){return this._passThroughHandler(e,!1)}}},{"./util.js":59}],39:[function(e,t){"use strict";t.exports=function(t,r,n,i){function o(e,r){for(var n=l,s=t,a=r.length,u=0;a>u;++u){var c=f(r[u],void 0,e);if(c===n)return s.reject(n.e);var h=i(c,o);if(h instanceof s)return h}return null}function s(e,r,i){var o=this._promise=new t(n);o._setTrace(void 0),this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(d):d}var a=e("./errors.js"),u=a.TypeError,c=e("./util.js").deprecated,h=e("./util.js"),l=h.errorObj,f=h.tryCatch1,d=[];s.prototype.promise=function(){return this._promise},s.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},s.prototype._continue=function(e){if(e===l){this._generator=void 0;var r=a.canAttach(e.e)?e.e:new Error(e.e+"");return this._promise._attachExtraTrace(r),void this._promise._reject(e.e,r)}var n=e.value;if(e.done===!0)this._generator=void 0,this._promise._tryFollow(n)||this._promise._fulfill(n);else{var s=i(n,void 0);if(!(s instanceof t)&&(s=o(s,this._yieldHandlers),null===s))return void this._throw(new u("A value was yielded that could not be treated as a promise"));s._then(this._next,this._throw,void 0,this,null)}},s.prototype._throw=function(e){a.canAttach(e)&&this._promise._attachExtraTrace(e),this._continue(f(this._generator["throw"],this._generator,e))},s.prototype._next=function(e){this._continue(f(this._generator.next,this._generator,e))},t.coroutine=function(e,t){if("function"!=typeof e)throw new u("generatorFunction must be a function");var r=Object(t).yieldHandler,n=s;return function(){var t=e.apply(this,arguments),i=new n(void 0,void 0,r);return i._generator=t,i._next(void 0),i.promise()}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new u("fn must be a function");d.push(e)},t.spawn=function(e){if(c("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof e)return r("generatorFunction must be a function");var n=new s(e,this),i=n.promise();return n._run(t.spawn),i}}},{"./errors.js":34,"./util.js":59}],40:[function(e,t){"use strict";t.exports=function(t,r,n,i){var o=e("./util.js"),s=o.canEvaluate,a=o.tryCatch1,u=o.errorObj;if(s){for(var c=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},h=function(e){for(var t=[],r=1;e>=r;++r)t.push("holder.p"+r);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,t.join(", ")))},l=[],f=[void 0],d=1;5>=d;++d)l.push(c(d)),f.push(h(d));var p=function(e,t){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=t,this.total=e,this.now=0};p.prototype.callers=f,p.prototype.checkFulfillment=function(e){var t=this.now;t++;var r=this.total;if(t>=r){var n=this.callers[r],i=a(n,void 0,this);i===u?e._rejectUnchecked(i.e):e._tryFollow(i)||e._fulfillUnchecked(i)}else this.now=t}}t.join=function(){var e,o=arguments.length-1;if(o>0&&"function"==typeof arguments[o]&&(e=arguments[o],6>o&&s)){var a=new t(i);a._setTrace(void 0);for(var u=new p(o,e),c=a._reject,h=l,f=0;o>f;++f){var d=n(arguments[f],void 0);d instanceof t?d.isPending()?d._then(h[f],c,void 0,a,u):d.isFulfilled()?h[f].call(a,d._settledValue,u):(a._reject(d._settledValue),d._unsetRejectionIsUnhandled()):h[f].call(a,d,u)}return a}for(var _=arguments.length,v=new Array(_),y=0;_>y;++y)v[y]=arguments[y];var a=new r(v).promise();return void 0!==e?a.spread(e):a}}},{"./util.js":59}],41:[function(e,t){"use strict";t.exports=function(t,r,n,i,o){function s(e,t,r,n){this.constructor$(e),this._callback=t,this._preservedValues=n===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=r>=1?[]:f,this._init$(void 0,-2)}function a(e,t,r,n){var i="object"==typeof r&&null!==r?r.concurrency:0;return i="number"==typeof i&&isFinite(i)&&i>=1?i:0,new s(e,t,i,n)}var u=e("./util.js"),c=u.tryCatch3,h=u.errorObj,l={},f=[];u.inherits(s,r),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,r){var n=this._values;if(null!==n){var o=this.length(),s=this._preservedValues,a=this._limit;if(n[r]===l){if(n[r]=e,a>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(a>=1&&this._inFlight>=a)return n[r]=e,void this._queue.push(r);null!==s&&(s[r]=e);var u=this._callback,f=this._promise._boundTo,d=c(u,f,e,r,o);if(d===h)return this._reject(d.e);var p=i(d,void 0);if(p instanceof t){if(p.isPending())return a>=1&&this._inFlight++,n[r]=l,p._proxyPromiseArray(this,r);if(!p.isFulfilled())return p._unsetRejectionIsUnhandled(),this._reject(p.reason());d=p.value()}n[r]=d}var _=++this._totalResolved;_>=o&&(null!==s?this._filter(n,s):this._resolve(n))}},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){var n=e.pop();this._promiseFulfilled(r[n],n)}},s.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),i=0,o=0;r>o;++o)e[o]&&(n[i++]=t[o]);n.length=i,this._resolve(n)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return"function"!=typeof e?n("fn must be a function"):a(this,e,t,null).promise()},t.map=function(e,t,r,i){return"function"!=typeof t?n("fn must be a function"):a(e,t,r,i).promise()}}},{"./util.js":59}],42:[function(e,t){"use strict";t.exports=function(t){function r(e){throw e}function n(e,t){if(!s.isArray(e))return i(e,t);var n=s.tryCatchApply(this,[null].concat(e),t);n===h&&a.invokeLater(r,void 0,n.e)}function i(e,t){var n=this,i=void 0===e?c(n,t,null):u(n,t,null,e);i===h&&a.invokeLater(r,void 0,i.e)}function o(e,t){var n=this,i=c(n,t,e);i===h&&a.invokeLater(r,void 0,i.e)}var s=e("./util.js"),a=e("./async.js"),u=s.tryCatch2,c=s.tryCatch1,h=s.errorObj;t.prototype.nodeify=function(e,t){if("function"==typeof e){var r=i;void 0!==t&&Object(t).spread&&(r=n),this._then(r,o,void 0,e,this._boundTo)}return this}}},{"./async.js":26,"./util.js":59}],43:[function(e,t){"use strict";t.exports=function(t,r){var n=e("./util.js"),i=e("./async.js"),o=e("./errors.js"),s=n.tryCatch1,a=n.errorObj;t.prototype.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0)},t.prototype._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(e)},t.prototype._clearFirstHandlerData$Base=t.prototype._clearFirstHandlerData,t.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},t.prototype._progressHandlerAt=function(e){return 0===e?this._progressHandler0:this[(e<<2)+e-5+2]},t.prototype._doProgressWith=function(e){var r=e.value,n=e.handler,i=e.promise,u=e.receiver,c=s(n,u,r);if(c===a){if(null!=c.e&&"StopProgressPropagation"!==c.e.name){var h=o.canAttach(c.e)?c.e:new Error(c.e+"");i._attachExtraTrace(h),i._progress(c.e)}}else c instanceof t?c._then(i._progress,null,null,i,void 0):i._progress(c)},t.prototype._progressUnchecked=function(e){if(this.isPending())for(var n=this._length(),o=this._progress,s=0;n>s;s++){var a=this._progressHandlerAt(s),u=this._promiseAt(s);if(u instanceof t)"function"==typeof a?i.invoke(this._doProgressWith,this,{handler:a,promise:u,receiver:this._receiverAt(s),value:e}):i.invoke(o,u,e);else{var c=this._receiverAt(s);"function"==typeof a?a.call(c,e,u):c instanceof t&&c._isProxied()?c._progressUnchecked(e):c instanceof r&&c._promiseProgressed(e,u)}}}}},{"./async.js":26,"./errors.js":34,"./util.js":59}],44:[function(e,t){(function(r){"use strict";function n(e){try{Promise===e&&(Promise=i)}catch(t){}return e}var i;"undefined"!=typeof Promise&&(i=Promise),t.exports=function(){function t(e){if("function"!=typeof e)throw new j("the promise constructor requires a resolver function");if(this.constructor!==t)throw new j("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,e!==u&&this._resolveFromResolver(e)}function i(e){return e[0]}var o=e("./util.js"),s=e("./async.js"),a=e("./errors.js"),u=function(){},c={},h={e:null},l=e("./thenables.js")(t,u),f=e("./promise_array.js")(t,u,l),d=e("./captured_trace.js")(),p=e("./catch_filter.js")(h),_=e("./promise_resolver.js"),v=o.isArray,y=o.errorObj,g=o.tryCatch1,m=o.tryCatch2,E=o.tryCatchApply,b=a.RangeError,j=a.TypeError,T=a.CancellationError,w=a.TimeoutError,C=a.OperationalError,A=a.originatesFromRejection,S=a.markAsOriginatingFromRejection,R=a.canAttach,F=o.thrower,P=e("./errors_api_rejection")(t),O=function(){return new j("circular promise resolution chain")};t.prototype.bind=function(e){var r=l(e,void 0),n=new t(u);if(r instanceof t){var o=r.then(function(e){n._setBoundTo(e)}),s=t.all([this,o]).then(i);n._follow(s)}else n._follow(this),n._setBoundTo(e);return n._propagateFrom(this,3),n},t.prototype.toString=function(){return"[object Promise]"},t.prototype.caught=t.prototype["catch"]=function(e){var r=arguments.length;if(r>1){var n,i=new Array(r-1),o=0;for(n=0;r-1>n;++n){var s=arguments[n];if("function"!=typeof s){var a=new j("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(a),t.reject(a)}i[o++]=s}i.length=o,e=arguments[n],this._resetTrace();var u=new p(i,e,this);return this._then(void 0,u.doFilter,void 0,u,void 0)}return this._then(void 0,e,void 0,void 0,void 0)},t.prototype.then=function(e,t,r){return this._then(e,t,r,void 0,void 0)},t.prototype.done=function(e,t,r){var n=this._then(e,t,r,void 0,void 0);n._setIsFinal()},t.prototype.spread=function(e,t){return this._then(e,t,void 0,c,void 0)},t.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},t.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this._settledValue,e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this._settledValue,e.isRejected=!0),e},t.prototype.all=function(){return new f(this).promise()},t.is=function(e){return e instanceof t},t.all=function(e){return new f(e).promise()},t.prototype.error=function(e){return this.caught(A,e)},t.prototype._resolveFromSyncValue=function(e){if(e===y)this._cleanValues(),this._setRejected(),this._settledValue=e.e,this._ensurePossibleRejectionHandled();else{var r=l(e,void 0);r instanceof t?this._follow(r):(this._cleanValues(),this._setFulfilled(),this._settledValue=e)}},t.method=function(e){if("function"!=typeof e)throw new j("fn must be a function");return function(){var r;switch(arguments.length){case 0:r=g(e,this,void 0);break;case 1:r=g(e,this,arguments[0]);break;case 2:r=m(e,this,arguments[0],arguments[1]);break;default:for(var n=arguments.length,i=new Array(n),o=0;n>o;++o)i[o]=arguments[o];r=E(e,i,this)}var s=new t(u);return s._setTrace(void 0),s._resolveFromSyncValue(r),s}},t.attempt=t["try"]=function(e,r,n){if("function"!=typeof e)return P("fn must be a function");var i=v(r)?E(e,r,n):g(e,n,r),o=new t(u);return o._setTrace(void 0),o._resolveFromSyncValue(i),o},t.defer=t.pending=function(){var e=new t(u);return e._setTrace(void 0),new _(e)},t.bind=function(e){var r=l(e,void 0),n=new t(u);if(n._setTrace(void 0),r instanceof t){var i=r.then(function(e){n._setBoundTo(e)});n._follow(i)}else n._setBoundTo(e),n._setFulfilled();return n},t.cast=function(e){var r=l(e,void 0);if(!(r instanceof t)){var n=r;r=new t(u),r._setTrace(void 0),r._setFulfilled(),r._cleanValues(),r._settledValue=n}return r},t.resolve=t.fulfilled=t.cast,t.reject=t.rejected=function(e){var r=new t(u);if(r._setTrace(void 0),S(e),r._cleanValues(),r._setRejected(),r._settledValue=e,!R(e)){var n=new Error(e+"");r._setCarriedStackTrace(n)}return r._ensurePossibleRejectionHandled(),r},t.onPossiblyUnhandledRejection=function(e){d.possiblyUnhandledRejection="function"==typeof e?e:void 0};var N;t.onUnhandledRejectionHandled=function(e){N="function"==typeof e?e:void 0};var I=!1||!("undefined"==typeof r||"string"!=typeof r.execPath||"object"!=typeof r.env||!r.env.BLUEBIRD_DEBUG&&"development"!==r.env.NODE_ENV);t.longStackTraces=function(){if(s.haveItemsQueued()&&I===!1)throw new Error("cannot enable long stack traces after promises have been created");I=d.isSupported()},t.hasLongStackTraces=function(){return I&&d.isSupported()},t.prototype._then=function(e,r,n,i,o){var a=void 0!==o,c=a?o:new t(u);if(!a){if(I){var h=this._peekContext()===this._traceParent;c._traceParent=h?this._traceParent:this}c._propagateFrom(this,7)}var l=this._addCallbacks(e,r,n,c,i);return this.isResolved()&&s.invoke(this._queueSettleAt,this,l),c},t.prototype._length=function(){return 262143&this._bitField},t.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},t.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},t.prototype._setLength=function(e){this._bitField=-262144&this._bitField|262143&e},t.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},t.prototype._setRejected=function(){this._bitField=134217728|this._bitField},t.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},t.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},t.prototype._isFinal=function(){return(33554432&this._bitField)>0},t.prototype._cancellable=function(){return(67108864&this._bitField)>0},t.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},t.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},t.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},t.prototype._setCarriedStackTrace=function(e){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=e},t.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},t.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},t.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},t.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[(e<<2)+e-5+4];return this._isBound()&&void 0===t?this._boundTo:t},t.prototype._promiseAt=function(e){return 0===e?this._promise0:this[(e<<2)+e-5+3]},t.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[(e<<2)+e-5+0]},t.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[(e<<2)+e-5+1]},t.prototype._addCallbacks=function(e,t,r,n,i){var o=this._length();if(o>=262138&&(o=0,this._setLength(0)),0===o)this._promise0=n,void 0!==i&&(this._receiver0=i),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=e),"function"==typeof t&&(this._rejectionHandler0=t),"function"==typeof r&&(this._progressHandler0=r);else{var s=(o<<2)+o-5;this[s+3]=n,this[s+4]=i,this[s+0]="function"==typeof e?e:void 0,this[s+1]="function"==typeof t?t:void 0,this[s+2]="function"==typeof r?r:void 0}return this._setLength(o+1),o},t.prototype._setProxyHandlers=function(e,t){var r=this._length();if(r>=262138&&(r=0,this._setLength(0)),0===r)this._promise0=t,this._receiver0=e;else{var n=(r<<2)+r-5;this[n+3]=t,this[n+4]=e,this[n+0]=this[n+1]=this[n+2]=void 0}this._setLength(r+1)},t.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)},t.prototype._proxyPromise=function(e){e._setProxied(),this._setProxyHandlers(e,-15)},t.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=8388608|this._bitField,this._boundTo=e):this._bitField=-8388609&this._bitField},t.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},t.prototype._resolveFromResolver=function(e){function t(e){n._tryFollow(e)||n._fulfill(e)}function r(e){var t=R(e)?e:new Error(e+"");n._attachExtraTrace(t),S(e),n._reject(e,t===e?void 0:t)}var n=this;this._setTrace(void 0),this._pushContext();var i=m(e,void 0,t,r);if(this._popContext(),void 0!==i&&i===y){var o=i.e,s=R(o)?o:new Error(o+"");n._reject(o,s)}},t.prototype._spreadSlowCase=function(e,t,r,n){var i=new f(r).promise(),o=i._then(function(){return e.apply(n,arguments)},void 0,void 0,c,void 0);t._follow(o)},t.prototype._callSpread=function(e,r,n){var i=this._boundTo;if(v(n))for(var o=0,s=n.length;s>o;++o)if(l(n[o],void 0)instanceof t)return void this._spreadSlowCase(e,r,n,i);return r._pushContext(),E(e,n,i)},t.prototype._callHandler=function(e,t,r,n){var i;return t!==c||this.isRejected()?(r._pushContext(),i=g(e,t,n)):i=this._callSpread(e,r,n),r._popContext(),i},t.prototype._settlePromiseFromHandler=function(e,r,n,i){if(!(i instanceof t))return void e.call(r,n,i);var o=this._callHandler(e,r,i,n);if(!i._isFollowing())if(o===y||o===i||o===h){var s=o===i?O():o.e,a=R(s)?s:new Error(s+"");o!==h&&i._attachExtraTrace(a),i._rejectUnchecked(s,a)}else{var u=l(o,i);if(u instanceof t){if(u.isRejected()&&!u._isCarryingStackTrace()&&!R(u._settledValue)){var a=new Error(u._settledValue+"");i._attachExtraTrace(a),u._setCarriedStackTrace(a)}i._follow(u),i._propagateFrom(u,1)}else i._fulfillUnchecked(o)}},t.prototype._follow=function(e){this._setFollowing(),e.isPending()?(this._propagateFrom(e,1),e._proxyPromise(this)):e.isFulfilled()?this._fulfillUnchecked(e._settledValue):this._rejectUnchecked(e._settledValue,e._getCarriedStackTrace()),e._isRejectionUnhandled()&&e._unsetRejectionIsUnhandled(),I&&null==e._traceParent&&(e._traceParent=this)},t.prototype._tryFollow=function(e){if(this._isFollowingOrFulfilledOrRejected()||e===this)return!1;var r=l(e,void 0);return r instanceof t?(this._follow(r),!0):!1},t.prototype._resetTrace=function(){I&&(this._trace=new d(void 0===this._peekContext()))},t.prototype._setTrace=function(e){if(I){var t=this._peekContext();this._traceParent=t;var r=void 0===t;this._trace=void 0!==e&&e._traceParent===t?e._trace:new d(r)}return this},t.prototype._attachExtraTrace=function(e){if(I){var t=this,r=e.stack;r="string"==typeof r?r.split("\n"):[],d.protectErrorMessageNewlines(r);for(var n=1,i=1;null!=t&&null!=t._trace;)r=d.combine(r,t._trace.stack.split("\n")),t=t._traceParent,i++;var o=Error.stackTraceLimit||10,s=(o+n)*i,a=r.length;a>s&&(r.length=s),a>0&&(r[0]=r[0].split("\x00").join("\n")),e.stack=r.length<=n?"(No stack trace)":r.join("\n")}},t.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},t.prototype._propagateFrom=function(e,t){(1&t)>0&&e._cancellable()&&(this._setCancellable(),this._cancellationParent=e),(4&t)>0&&this._setBoundTo(e._boundTo),(2&t)>0&&this._setTrace(e)
},t.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},t.prototype._reject=function(e,t){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,t)},t.prototype._settlePromiseAt=function(e){var r=this.isFulfilled()?this._fulfillmentHandlerAt(e):this._rejectionHandlerAt(e),n=this._settledValue,i=this._receiverAt(e),o=this._promiseAt(e);if("function"==typeof r)this._settlePromiseFromHandler(r,i,n,o);else{var s=!1,a=this.isFulfilled();void 0!==i&&(i instanceof t&&i._isProxied()?(i._unsetProxied(),a?i._fulfillUnchecked(n):i._rejectUnchecked(n,this._getCarriedStackTrace()),s=!0):i instanceof f&&(a?i._promiseFulfilled(n,o):i._promiseRejected(n,o),s=!0)),s||(a?o._fulfill(n):o._reject(n,this._getCarriedStackTrace()))}e>=4&&this._queueGC()},t.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},t.prototype._setProxied=function(){this._bitField=4194304|this._bitField},t.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},t.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},t.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},t.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},t.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),s.invokeLater(this._gc,this,void 0))},t.prototype._gc=function(){for(var e=5*this._length()-5,t=0;e>t;t++)delete this[t];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},t.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},t.prototype._queueSettleAt=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),s.invoke(this._settlePromiseAt,this,e)},t.prototype._fulfillUnchecked=function(e){if(this.isPending()){if(e===this){var t=O();return this._attachExtraTrace(t),this._rejectUnchecked(t,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=e;var r=this._length();r>0&&s.invoke(this._settlePromises,this,r)}},t.prototype._rejectUncheckedCheckError=function(e){var t=R(e)?e:new Error(e+"");this._rejectUnchecked(e,t===e?void 0:t)},t.prototype._rejectUnchecked=function(e,t){if(this.isPending()){if(e===this){var r=O();return this._attachExtraTrace(r),this._rejectUnchecked(r)}if(this._cleanValues(),this._setRejected(),this._settledValue=e,this._isFinal())return void s.invokeLater(F,void 0,void 0===t?e:t);var n=this._length();void 0!==t&&this._setCarriedStackTrace(t),n>0?s.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},t.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},t.prototype._settlePromises=function(){for(var e=this._length(),t=0;e>t;t++)this._settlePromiseAt(t)},t.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==d.possiblyUnhandledRejection&&s.invokeLater(this._notifyUnhandledRejection,this,void 0)},t.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof N&&s.invokeLater(N,void 0,this)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue,t=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==t&&(this._unsetCarriedStackTrace(),e=t),"function"==typeof d.possiblyUnhandledRejection&&d.possiblyUnhandledRejection(e,this)}};var q=[];return t.prototype._peekContext=function(){var e=q.length-1;return e>=0?q[e]:void 0},t.prototype._pushContext=function(){I&&q.push(this)},t.prototype._popContext=function(){I&&q.pop()},t.noConflict=function(){return n(t)},t.setScheduler=function(e){if("function"!=typeof e)throw new j("fn must be a function");s._schedule=e},d.isSupported()||(t.longStackTraces=function(){},I=!1),t._makeSelfResolutionError=O,e("./finally.js")(t,h,l),e("./direct_resolve.js")(t),e("./synchronous_inspection.js")(t),e("./join.js")(t,f,l,u),t.RangeError=b,t.CancellationError=T,t.TimeoutError=w,t.TypeError=j,t.OperationalError=C,t.RejectionError=C,t.AggregateError=a.AggregateError,o.toFastProperties(t),o.toFastProperties(t.prototype),t.Promise=t,e("./timers.js")(t,u,l),e("./race.js")(t,u,l),e("./call_get.js")(t),e("./generators.js")(t,P,u,l),e("./map.js")(t,f,P,l,u),e("./nodeify.js")(t),e("./promisify.js")(t,u),e("./props.js")(t,f,l),e("./reduce.js")(t,f,P,l,u),e("./settle.js")(t,f),e("./some.js")(t,f,P),e("./progress.js")(t,f),e("./cancel.js")(t,u),e("./filter.js")(t,u),e("./any.js")(t,f),e("./each.js")(t,u),e("./using.js")(t,P,l),t.prototype=t.prototype,t}}).call(this,e("FWaASH"))},{"./any.js":25,"./async.js":26,"./call_get.js":28,"./cancel.js":29,"./captured_trace.js":30,"./catch_filter.js":31,"./direct_resolve.js":32,"./each.js":33,"./errors.js":34,"./errors_api_rejection":35,"./filter.js":37,"./finally.js":38,"./generators.js":39,"./join.js":40,"./map.js":41,"./nodeify.js":42,"./progress.js":43,"./promise_array.js":45,"./promise_resolver.js":46,"./promisify.js":47,"./props.js":48,"./race.js":50,"./reduce.js":51,"./settle.js":53,"./some.js":54,"./synchronous_inspection.js":55,"./thenables.js":56,"./timers.js":57,"./using.js":58,"./util.js":59,FWaASH:63}],45:[function(e,t){"use strict";t.exports=function(t,r,n){function i(e){switch(e){case-1:return void 0;case-2:return[];case-3:return{}}}function o(e){var n=this._promise=new t(r),i=void 0;e instanceof t&&(i=e,n._propagateFrom(i,5)),n._setTrace(i),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var s=e("./errors.js").canAttach,a=e("./util.js"),u=a.isArray;return o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function c(e,r){var o=n(this._values,void 0);if(o instanceof t){if(this._values=o,o._setBoundTo(this._promise._boundTo),!o.isFulfilled())return o.isPending()?void o._then(c,this._reject,void 0,this,r):(o._unsetRejectionIsUnhandled(),void this._reject(o._settledValue));if(o=o._settledValue,!u(o)){var s=new t.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(s)}}else if(!u(o)){var s=new t.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(s)}if(0===o.length)return void(-5===r?this._resolveEmptyArray():this._resolve(i(r)));for(var a=this.getActualLength(o.length),h=a,l=this.shouldCopyValues()?new Array(a):this._values,f=!1,d=0;a>d;++d){var p=n(o[d],void 0);p instanceof t?p.isPending()?p._proxyPromiseArray(this,d):(p._unsetRejectionIsUnhandled(),f=!0):f=!0,l[d]=p}this._values=l,this._length=h,f&&this._scanDirectValues(a)},o.prototype._settlePromiseAt=function(e){var r=this._values[e];r instanceof t?r.isFulfilled()?this._promiseFulfilled(r._settledValue,e):r.isRejected()&&this._promiseRejected(r._settledValue,e):this._promiseFulfilled(r,e)},o.prototype._scanDirectValues=function(e){for(var t=0;e>t&&!this._isResolved();++t)this._settlePromiseAt(t)},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},o.prototype.__hardReject__=o.prototype._reject=function(e){this._values=null;var t=s(e)?e:new Error(e+"");this._promise._attachExtraTrace(t),this._promise._reject(e,t)},o.prototype._promiseProgressed=function(e,t){this._isResolved()||this._promise._progress({index:t,value:e})},o.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t]=e;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)}},o.prototype._promiseRejected=function(e){this._isResolved()||(this._totalResolved++,this._reject(e))},o.prototype.shouldCopyValues=function(){return!0},o.prototype.getActualLength=function(e){return e},o}},{"./errors.js":34,"./util.js":59}],46:[function(e,t){"use strict";function r(e){return e instanceof Error&&d.getPrototypeOf(e)===Error.prototype}function n(e){var t;return t=r(e)?new h(e):e,u.markAsOriginatingFromRejection(t),t}function i(e){function t(t,r){if(null!==e){if(t){var i=n(a(t));e._attachExtraTrace(i),e._reject(i)}else if(arguments.length>2){for(var o=arguments.length,s=new Array(o-1),u=1;o>u;++u)s[u-1]=arguments[u];e._fulfill(s)}else e._fulfill(r);e=null}}return t}var o,s=e("./util.js"),a=s.maybeWrapAsError,u=e("./errors.js"),c=u.TimeoutError,h=u.OperationalError,l=e("./async.js"),f=s.haveGetters,d=e("./es5.js");if(o=f?function(e){this.promise=e}:function(e){this.promise=e,this.asCallback=i(e),this.callback=this.asCallback},f){var p={get:function(){return i(this.promise)}};d.defineProperty(o.prototype,"asCallback",p),d.defineProperty(o.prototype,"callback",p)}o._nodebackForPromise=i,o.prototype.toString=function(){return"[object PromiseResolver]"},o.prototype.resolve=o.prototype.fulfill=function(e){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var t=this.promise;t._tryFollow(e)||l.invoke(t._fulfill,t,e)},o.prototype.reject=function(e){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var t=this.promise;u.markAsOriginatingFromRejection(e);var r=u.canAttach(e)?e:new Error(e+"");t._attachExtraTrace(r),l.invoke(t._reject,t,e),r!==e&&l.invoke(this._setCarriedStackTrace,this,r)},o.prototype.progress=function(e){if(!(this instanceof o))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");l.invoke(this.promise._progress,this.promise,e)},o.prototype.cancel=function(){l.invoke(this.promise.cancel,this.promise,void 0)},o.prototype.timeout=function(){this.reject(new c("timeout"))},o.prototype.isResolved=function(){return this.promise.isResolved()},o.prototype.toJSON=function(){return this.promise.toJSON()},o.prototype._setCarriedStackTrace=function(e){this.promise.isRejected()&&this.promise._setCarriedStackTrace(e)},t.exports=o},{"./async.js":26,"./errors.js":34,"./es5.js":36,"./util.js":59}],47:[function(e,t){"use strict";t.exports=function(t,r){function n(e){return e.replace(/([$])/,"\\$")}function i(e){try{return e.__isPromisified__===!0}catch(t){return!1}}function o(e,t,r){var n=g.getDataPropertyOrDefault(e,t+r,A);return n?i(n):!1}function s(e,t,r){for(var n=0;n<e.length;n+=2){var i=e[n];if(r.test(i))for(var o=i.replace(r,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new T("Cannot promisify an API that has normal methods with '"+t+"'-suffix")}}function a(e,t,r,n){for(var a=g.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var h=a[c],l=e[h];"function"!=typeof l||i(l)||o(e,h,t)||!n(h,l,e)||u.push(h,l)}return s(u,t,r),u}function u(e){for(var t=[e],r=Math.max(0,e-1-5),n=e-1;n>=r;--n)n!==e&&t.push(n);for(var n=e+1;5>=n;++n)t.push(n);return t}function c(e){return g.filledRange(e,"arguments[","]")}function h(e){return g.filledRange(e,"_arg","")}function l(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0}function f(e){return g.isIdentifier(e)?"."+e:"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function d(e,n,i,o,s){function a(t){var r,i=c(t).join(", "),o=t>0?", ":"";return r="string"==typeof e?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",f(e)):n===y?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==n?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",r.replace("{{args}}",i).replace(", ",o)}function d(){for(var t="",r=0;r<_.length;++r)t+="case "+_[r]+":"+a(_[r]);var i;return i="string"==typeof e?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",f(e)):n===y?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",t+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",i)}var p=Math.max(0,l(o)-1),_=u(p),v="string"==typeof i&&g.isIdentifier(i)?i+s:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",v).replace("Parameters",h(p)).replace("[CodeForSwitchCase]",d()))(t,e,n,E,b,m,r)}function p(e,n){function i(){var i=n;n===y&&(i=this),"string"==typeof e&&(e=i[e]);var o=new t(r);o._setTrace(void 0);var s=m(o);try{e.apply(i,E(arguments,s))}catch(a){var u=b(a);o._attachExtraTrace(u),o._reject(u)}return o}return i.__isPromisified__=!0,i}function _(e,t,r,i){for(var o=new RegExp(n(t)+"$"),s=a(e,t,o,r),u=0,c=s.length;c>u;u+=2){var h=s[u],l=s[u+1],f=h+t;e[f]=i===S?S(h,y,h,l,t):i(l)}return g.toFastProperties(e),e}function v(e,t){return S(e,t,void 0,e)}var y={},g=e("./util.js"),m=e("./promise_resolver.js")._nodebackForPromise,E=g.withAppended,b=g.maybeWrapAsError,j=g.canEvaluate,T=e("./errors").TypeError,w="Async",C=function(e,t){return g.isIdentifier(e)&&"_"!==e.charAt(0)&&!g.isClass(t)},A={__isPromisified__:!0},S=j?d:p;t.promisify=function(e,t){if("function"!=typeof e)throw new T("fn must be a function");return i(e)?e:v(e,arguments.length<2?y:t)},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new T("the target of promisifyAll must be an object or a function");t=Object(t);var r=t.suffix;"string"!=typeof r&&(r=w);var n=t.filter;"function"!=typeof n&&(n=C);var i=t.promisifier;if("function"!=typeof i&&(i=S),!g.isIdentifier(r))throw new RangeError("suffix must be a valid identifier");for(var o=g.inheritedDataKeys(e,{includeHidden:!0}),s=0;s<o.length;++s){var a=e[o[s]];"constructor"!==o[s]&&g.isClass(a)&&(_(a.prototype,r,n,i),_(a,r,n,i))}return _(e,r,n,i)}}},{"./errors":34,"./promise_resolver.js":46,"./util.js":59}],48:[function(e,t){"use strict";t.exports=function(t,r,n){function i(e){for(var t=c.keys(e),r=t.length,n=new Array(2*r),i=0;r>i;++i){var o=t[i];n[i]=e[o],n[i+r]=o}this.constructor$(n)}function o(e){var r,o=n(e,void 0);return u(o)?(r=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new i(o).promise(),o instanceof t&&r._propagateFrom(o,4),r):a("cannot await properties of a non-object")}var s=e("./util.js"),a=e("./errors_api_rejection")(t),u=s.isObject,c=e("./es5.js");s.inherits(i,r),i.prototype._init=function(){this._init$(void 0,-3)},i.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t]=e;var r=++this._totalResolved;if(r>=this._length){for(var n={},i=this.length(),o=0,s=this.length();s>o;++o)n[this._values[o+i]]=this._values[o];this._resolve(n)}}},i.prototype._promiseProgressed=function(e,t){this._isResolved()||this._promise._progress({key:this._values[t+this.length()],value:e})},i.prototype.shouldCopyValues=function(){return!1},i.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return o(this)},t.props=function(e){return o(e)}}},{"./errors_api_rejection":35,"./es5.js":36,"./util.js":59}],49:[function(e,t){"use strict";function r(e,t,r,n,i){for(var o=0;i>o;++o)r[o+n]=e[o+t]}function n(e){this._capacity=e,this._length=0,this._front=0,this._makeCapacity()}n.prototype._willBeOverCapacity=function(e){return this._capacity<e},n.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var r=this._front+t&this._capacity-1;this[r]=e,this._length=t+1},n.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var i=this._front+n-3;this._checkCapacity(n);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=r,this._length=n},n.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},n.prototype.length=function(){return this._length},n.prototype._makeCapacity=function(){for(var e=this._capacity,t=0;e>t;++t)this[t]=void 0},n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<3)},n.prototype._resizeTo=function(e){var t=this._front,n=this._capacity,i=new Array(n),o=this.length();if(r(this,0,i,0,n),this._capacity=e,this._makeCapacity(),this._front=0,n>=t+o)r(i,t,this,0,o);else{var s=o-(t+o&n-1);r(i,t,this,0,s),r(i,0,this,s,o-s)}},t.exports=n},{}],50:[function(e,t){"use strict";t.exports=function(t,r,n){function i(e,i){var c=n(e,void 0);if(c instanceof t)return a(c);if(!s(e))return o("expecting an array, a promise or a thenable");var h=new t(r);void 0!==i?h._propagateFrom(i,7):h._setTrace(void 0);for(var l=h._fulfill,f=h._reject,d=0,p=e.length;p>d;++d){var _=e[d];(void 0!==_||u.call(e,d))&&t.cast(_)._then(l,f,void 0,h,null)}return h}var o=e("./errors_api_rejection.js")(t),s=e("./util.js").isArray,a=function(e){return e.then(function(t){return i(t,e)})},u={}.hasOwnProperty;t.race=function(e){return i(e,void 0)},t.prototype.race=function(){return i(this,void 0)}}},{"./errors_api_rejection.js":35,"./util.js":59}],51:[function(e,t){"use strict";t.exports=function(t,r,n,i,o){function s(e,r,n,s){this.constructor$(e),this._preservedValues=s===o?[]:null,this._zerothIsAccum=void 0===n,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var a=i(n,void 0),u=!1,c=a instanceof t;c&&(a.isPending()?a._proxyPromiseArray(this,-1):a.isFulfilled()?(n=a.value(),this._gotAccum=!0):(a._unsetRejectionIsUnhandled(),this._reject(a.reason()),u=!0)),c||this._zerothIsAccum||(this._gotAccum=!0),this._callback=r,this._accum=n,u||this._init$(void 0,-5)}function a(e,t,r,i){if("function"!=typeof t)return n("fn must be a function");var o=new s(e,t,r,i);return o.promise()}var u=e("./util.js"),c=u.tryCatch4,h=u.tryCatch3,l=u.errorObj;u.inherits(s,r),s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},s.prototype._promiseFulfilled=function(e,r){var n=this._values;if(null!==n){var o,s=this.length(),a=this._preservedValues,u=null!==a,f=this._gotAccum,d=this._valuesPhase;if(!d)for(d=this._valuesPhase=Array(s),o=0;s>o;++o)d[o]=0;if(o=d[r],0===r&&this._zerothIsAccum?(f||(this._accum=e,this._gotAccum=f=!0),d[r]=0===o?1:2):-1===r?f||(this._accum=e,this._gotAccum=f=!0):0===o?d[r]=1:(d[r]=2,f&&(this._accum=e)),f){for(var p,_=this._callback,v=this._promise._boundTo,y=this._reducingIndex;s>y;++y)if(o=d[y],2!==o){if(1!==o)return;if(e=n[y],e instanceof t){if(!e.isFulfilled())return e.isPending()?void 0:(e._unsetRejectionIsUnhandled(),this._reject(e.reason()));e=e._settledValue}if(u?(a.push(e),p=h(_,v,e,y,s)):p=c(_,v,this._accum,e,y,s),p===l)return this._reject(p.e);var g=i(p,void 0);if(g instanceof t){if(g.isPending())return d[y]=4,g._proxyPromiseArray(this,y);if(!g.isFulfilled())return g._unsetRejectionIsUnhandled(),this._reject(g.reason());p=g.value()}this._reducingIndex=y+1,this._accum=p}else this._reducingIndex=y+1;this._reducingIndex<s||this._resolve(u?a:this._accum)}}},t.prototype.reduce=function(e,t){return a(this,e,t,null)},t.reduce=function(e,t,r,n){return a(e,t,r,n)}}},{"./util.js":59}],52:[function(e,t){(function(e){"use strict";var r,n;if("object"==typeof e&&"string"==typeof e.version)r=function(t){e.nextTick(t)};else if("undefined"!=typeof MutationObserver&&(n=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(n=WebKitMutationObserver))r=function(){var e=document.createElement("div"),t=void 0,r=new n(function(){var e=t;t=void 0,e()});return r.observe(e,{attributes:!0}),function(r){t=r,e.classList.toggle("foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");r=function(e){setTimeout(e,0)}}t.exports=r}).call(this,e("FWaASH"))},{FWaASH:63}],53:[function(e,t){"use strict";t.exports=function(t,r){function n(e){this.constructor$(e)}var i=t.PromiseInspection,o=e("./util.js");o.inherits(n,r),n.prototype._promiseResolved=function(e,t){this._values[e]=t;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},n.prototype._promiseFulfilled=function(e,t){if(!this._isResolved()){var r=new i;r._bitField=268435456,r._settledValue=e,this._promiseResolved(t,r)}},n.prototype._promiseRejected=function(e,t){if(!this._isResolved()){var r=new i;r._bitField=134217728,r._settledValue=e,this._promiseResolved(t,r)}},t.settle=function(e){return new n(e).promise()},t.prototype.settle=function(){return new n(this).promise()}}},{"./util.js":59}],54:[function(e,t){"use strict";t.exports=function(t,r,n){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||0>t)return n("expecting a positive integer");var r=new i(e),o=r.promise();return o.isRejected()?o:(r.setHowMany(t),r.init(),o)}var s=e("./util.js"),a=e("./errors.js").RangeError,u=e("./errors.js").AggregateError,c=s.isArray;s.inherits(i,r),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._isResolved()||(this._howMany=e)},i.prototype._promiseFulfilled=function(e){this._isResolved()||(this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},i.prototype._promiseRejected=function(e){if(!this._isResolved()&&(this._addRejected(e),this.howMany()>this._canPossiblyFulfill())){for(var t=new u,r=this.length();r<this._values.length;++r)t.push(this._values[r]);this._reject(t)}},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new a(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors.js":34,"./util.js":59}],55:[function(e,t){"use strict";t.exports=function(e){function t(e){void 0!==e?(this._bitField=e._bitField,this._settledValue=e.isResolved()?e._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}t.prototype.isFulfilled=e.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},t.prototype.isRejected=e.prototype.isRejected=function(){return(134217728&this._bitField)>0},t.prototype.isPending=e.prototype.isPending=function(){return 0===(402653184&this._bitField)},t.prototype.value=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},t.prototype.error=t.prototype.reason=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},t.prototype.isResolved=e.prototype.isResolved=function(){return(402653184&this._bitField)>0},e.PromiseInspection=t}},{}],56:[function(e,t){"use strict";t.exports=function(t,r){function n(e){try{return e.then}catch(t){return c.e=t,c}}function i(e,i){if(h(e)){if(e instanceof t)return e;if(o(e)){var a=new t(r);return a._setTrace(void 0),e._then(a._fulfillUnchecked,a._rejectUncheckedCheckError,a._progressUnchecked,a,null),a._setFollowing(),a}var l=n(e);if(l===c)return void 0!==i&&u(l.e)&&i._attachExtraTrace(l.e),t.reject(l.e);if("function"==typeof l)return s(e,l,i)}return e}function o(e){return l.call(e,"_promise0")}function s(e,r,n){function i(r){if(!c){if(c=!0,e===r){var i=t._makeSelfResolutionError();return void 0!==n&&n._attachExtraTrace(i),void a.promise._reject(i,void 0)}a.resolve(r)}}function o(e){if(!c){c=!0;var t=u(e)?e:new Error(e+"");void 0!==n&&n._attachExtraTrace(t),a.promise._reject(e,t)}}function s(e){if(!c){var t=a.promise;"function"==typeof t._progress&&t._progress(e)}}var a=t.defer(),c=!1;try{r.call(e,i,o,s)}catch(h){if(!c){c=!0;var l=u(h)?h:new Error(h+"");void 0!==n&&n._attachExtraTrace(l),a.promise._reject(h,l)}}return a.promise}var a=e("./util.js"),u=e("./errors.js").canAttach,c=a.errorObj,h=a.isObject,l={}.hasOwnProperty;return i}},{"./errors.js":34,"./util.js":59}],57:[function(e,t){"use strict";var r=function(e,t){var r=arguments.length,n=arguments[2],i=arguments[3],o=r>=5?arguments[4]:void 0;setTimeout(function(){e(n,i,o)},0|t)};t.exports=function(t,n,i){var o=(e("./util.js"),e("./errors.js")),s=(e("./errors_api_rejection")(t),t.TimeoutError),a=function(e,t,r){if(e.isPending()){"string"!=typeof t&&(t="operation timed out after "+r+" ms");var n=new s(t);o.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._cancel(n)}},u=function(e,t){t._fulfill(e)},c=t.delay=function(e,o){void 0===o&&(o=e,e=void 0),o=+o;var s=i(e,void 0),a=new t(n);return s instanceof t?(a._propagateFrom(s,7),a._follow(s),a.then(function(e){return t.delay(e,o)})):(a._setTrace(void 0),r(u,o,e,a),a)};t.prototype.delay=function(e){return c(this,e)},t.prototype.timeout=function(e,i){e=+e;var o=new t(n);return o._propagateFrom(this,7),o._follow(this),r(a,e,o,i,e),o.cancellable()}}},{"./errors.js":34,"./errors_api_rejection":35,"./util.js":59}],58:[function(e,t){"use strict";t.exports=function(t,r,n){function i(e){for(var r=e.length,n=0;r>n;++n){var i=e[n];if(i.isRejected())return t.reject(i.error());e[n]=i.value()}return e}function o(e){setTimeout(function(){throw e},0)}function s(e){var t=n(e,void 0);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function a(e,r){function i(){if(a>=u)return c.resolve();var h=s(e[a++]);if(h instanceof t&&h._isDisposable()){try{h=n(h._getDisposer().tryDispose(r),void 0)}catch(l){return o(l)}if(h instanceof t)return h._then(i,o,null,null,null)}i()}var a=0,u=e.length,c=t.defer();return i(),c.promise}function u(e){var t=new p;return t._settledValue=e,t._bitField=268435456,a(this,t).thenReturn(e)}function c(e){var t=new p;return t._settledValue=e,t._bitField=134217728,a(this,t).thenThrow(e)}function h(e,t){this._data=e,this._promise=t}function l(e,t){this.constructor$(e,t)}var f=e("./errors.js").TypeError,d=e("./util.js").inherits,p=t.PromiseInspection;h.prototype.data=function(){return this._data},h.prototype.promise=function(){return this._promise},h.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},h.prototype.tryDispose=function(e){var t=this.resource(),r=null!==t?this.doDispose(t,e):null;return this._promise._unsetDisposable(),this._data=this._promise=null,r},h.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},d(l,h),l.prototype.doDispose=function(e,t){var r=this.data();return r.call(e,e,t)},t.using=function(){var e=arguments.length;if(2>e)return r("you must pass at least 2 arguments to Promise.using");var n=arguments[e-1];if("function"!=typeof n)return r("fn must be a function");e--;for(var o=new Array(e),s=0;e>s;++s){var a=arguments[s];if(h.isDisposer(a)){var l=a;a=a.promise(),a._setDisposable(l)}o[s]=a}return t.settle(o).then(i).spread(n)._then(u,c,void 0,o,void 0)},t.prototype._setDisposable=function(e){this._bitField=262144|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(262144&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new l(e,this);throw new f}}},{"./errors.js":34,"./util.js":59}],59:[function(e,t,r){"use strict";function n(e,t,r){try{return e.call(t,r)}catch(n){return T.e=n,T}}function i(e,t,r,n){try{return e.call(t,r,n)}catch(i){return T.e=i,T}}function o(e,t,r,n,i){try{return e.call(t,r,n,i)}catch(o){return T.e=o,T}}function s(e,t,r,n,i,o){try{return e.call(t,r,n,i,o)}catch(s){return T.e=s,T}}function a(e,t,r){try{return e.apply(r,t)}catch(n){return T.e=n,T}}function u(e){return"string"==typeof e?e:""+e}function c(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function h(e){return!c(e)}function l(e){return c(e)?new Error(u(e)):e}function f(e,t){var r,n=e.length,i=new Array(n+1);for(r=0;n>r;++r)i[r]=e[r];
return i[r]=t,i}function d(e,t,r){if(!E.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function p(e,t,r){if(c(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return E.defineProperty(e,t,n),e}function _(e){throw e}function v(e){try{if("function"==typeof e){var t=E.keys(e.prototype);return t.length>0&&!(1===t.length&&"constructor"===t[0])}return!1}catch(r){return!1}}function y(e){function t(){}return t.prototype=e,t}function g(e){return S.test(e)}function m(e,t,r){for(var n=new Array(e),i=0;e>i;++i)n[i]=t+i+r;return n}var E=e("./es5.js"),b=function(){try{var e={};return E.defineProperty(e,"f",{get:function(){return 3}}),3===e.f}catch(t){return!1}}(),j="undefined"==typeof navigator,T={e:{}},w=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},C=function(){return"string"!==this}.call("string"),A=function(){return E.isES5?function(e,t){for(var r=[],n=Object.create(null),i=Object(t).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=e;){var o;try{o=i(e)}catch(s){return r}for(var a=0;a<o.length;++a){var u=o[a];if(!n[u]){n[u]=!0;var c=Object.getOwnPropertyDescriptor(e,u);null!=c&&null==c.get&&null==c.set&&r.push(u)}}e=E.getPrototypeOf(e)}return r}:function(e){var t=[];for(var r in e)t.push(r);return t}}(),S=/^[a-z$_][a-z$_0-9]*$/i,R={isClass:v,isIdentifier:g,inheritedDataKeys:A,getDataPropertyOrDefault:d,thrower:_,isArray:E.isArray,haveGetters:b,notEnumerableProp:p,isPrimitive:c,isObject:h,canEvaluate:j,errorObj:T,tryCatch1:n,tryCatch2:i,tryCatch3:o,tryCatch4:s,tryCatchApply:a,inherits:w,withAppended:f,asString:u,maybeWrapAsError:l,wrapsPrimitiveReceiver:C,toFastProperties:y,filledRange:m};t.exports=R},{"./es5.js":36}],60:[function(e,t){function r(e,t){if("function"!=typeof t)throw new Error("Bad callback given: "+t);if(!e)throw new Error("No options given");var s=e.onResponse;if(e="string"==typeof e?{uri:e}:JSON.parse(JSON.stringify(e)),e.onResponse=s,e.verbose&&(r.log=o()),e.url&&(e.uri=e.url,delete e.url),!e.uri&&""!==e.uri)throw new Error("options.uri is a required argument");if("string"!=typeof e.uri)throw new Error("options.uri must be a string");for(var a=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<a.length;c++)if(e[a[c]])throw new Error("options."+a[c]+" is not supported");if(e.callback=t,e.method=e.method||"GET",e.headers=e.headers||{},e.body=e.body||null,e.timeout=e.timeout||r.DEFAULT_TIMEOUT,e.headers.host)throw new Error("Options.headers.host is not supported");e.json&&(e.headers.accept=e.headers.accept||"application/json","GET"!==e.method&&(e.headers["content-type"]="application/json"),"boolean"!=typeof e.json?e.body=JSON.stringify(e.json):"string"!=typeof e.body&&(e.body=JSON.stringify(e.body)));var h=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")};if(e.qs){var l="string"==typeof e.qs?e.qs:h(e.qs);e.uri=-1!==e.uri.indexOf("?")?e.uri+"&"+l:e.uri+"?"+l}var f=function(e){var t={};t.boundry="-------------------------------"+Math.floor(1e9*Math.random());var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push("--"+t.boundry+'\nContent-Disposition: form-data; name="'+n+'"\n\n'+e[n]+"\n");return r.push("--"+t.boundry+"--"),t.body=r.join(""),t.length=t.body.length,t.type="multipart/form-data; boundary="+t.boundry,t};if(e.form){if("string"==typeof e.form)throw"form name unsupported";if("POST"===e.method){var d=(e.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(e.headers["content-type"]=d,d){case"application/x-www-form-urlencoded":e.body=h(e.form).replace(/%20/g,"+");break;case"multipart/form-data":var p=f(e.form);e.body=p.body,e.headers["content-type"]=p.type;break;default:throw new Error("unsupported encoding:"+d)}}}return e.onResponse=e.onResponse||i,e.onResponse===!0&&(e.onResponse=t,e.callback=i),!e.headers.authorization&&e.auth&&(e.headers.authorization="Basic "+u(e.auth.username+":"+e.auth.password)),n(e)}function n(e){function t(){h=!0;var t=new Error("ETIMEDOUT");return t.code="ETIMEDOUT",t.duration=e.timeout,r.log.error("Timeout",{id:u._id,milliseconds:e.timeout}),e.callback(t,u)}function n(){if(h)return r.log.debug("Ignoring timed out state change",{state:u.readyState,id:u.id});if(r.log.debug("State change",{state:u.readyState,id:u.id,timed_out:h}),u.readyState===c.OPENED){r.log.debug("Request started",{id:u.id});for(var t in e.headers)u.setRequestHeader(t,e.headers[t])}else u.readyState===c.HEADERS_RECEIVED?i():u.readyState===c.LOADING?(i(),o()):u.readyState===c.DONE&&(i(),o(),s())}function i(){if(!_.response){if(_.response=!0,r.log.debug("Got response",{id:u.id,status:u.status}),clearTimeout(u.timeoutTimer),u.statusCode=u.status,f&&0==u.statusCode){var t=new Error("CORS request rejected: "+e.uri);return t.cors="rejected",_.loading=!0,_.end=!0,e.callback(t,u)}e.onResponse(null,u)}}function o(){_.loading||(_.loading=!0,r.log.debug("Response body loading",{id:u.id}))}function s(){if(!_.end){if(_.end=!0,r.log.debug("Request done",{id:u.id}),u.body=u.responseText,e.json)try{u.body=JSON.parse(u.responseText)}catch(t){return e.callback(t,u)}e.callback(null,u,u.body)}}var u=new c,h=!1,f=a(e.uri),d="withCredentials"in u;if(l+=1,u.seq_id=l,u.id=l+": "+e.method+" "+e.uri,u._id=u.id,f&&!d){var p=new Error("Browser does not support cross-origin request: "+e.uri);return p.cors="unsupported",e.callback(p,u)}u.timeoutTimer=setTimeout(t,e.timeout);var _={response:!1,loading:!1,end:!1};return u.onreadystatechange=n,u.open(e.method,e.uri,!0),f&&(u.withCredentials=!!e.withCredentials),u.send(e.body),u}function i(){}function o(){var e,t,r={},n=["trace","debug","info","warn","error"];for(t=0;t<n.length;t++)e=n[t],r[e]=i,"undefined"!=typeof console&&console&&console[e]&&(r[e]=s(console,e));return r}function s(e,t){function r(r,n){return"object"==typeof n&&(r+=" "+JSON.stringify(n)),e[t].call(e,r)}return r}function a(e){var t,r=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{t=location.href}catch(n){t=document.createElement("a"),t.href="",t=t.href}var i=r.exec(t.toLowerCase())||[],o=r.exec(e.toLowerCase()),s=!(!o||o[1]==i[1]&&o[2]==i[2]&&(o[3]||("http:"===o[1]?80:443))==(i[3]||("http:"===i[1]?80:443)));return s}function u(e){var t,r,n,i,o,s,a,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0,l=0,f="",d=[];if(!e)return e;do t=e.charCodeAt(h++),r=e.charCodeAt(h++),n=e.charCodeAt(h++),u=t<<16|r<<8|n,i=u>>18&63,o=u>>12&63,s=u>>6&63,a=63&u,d[l++]=c.charAt(i)+c.charAt(o)+c.charAt(s)+c.charAt(a);while(h<e.length);switch(f=d.join(""),e.length%3){case 1:f=f.slice(0,-2)+"==";break;case 2:f=f.slice(0,-1)+"="}return f}var c=XMLHttpRequest;if(!c)throw new Error("missing XMLHttpRequest");r.log={trace:i,debug:i,info:i,warn:i,error:i};var h=18e4,l=0;r.withCredentials=!1,r.DEFAULT_TIMEOUT=h,r.defaults=function(e){var t=function(t){var r=function(r,n){r="string"==typeof r?{uri:r}:JSON.parse(JSON.stringify(r));for(var i in e)void 0===r[i]&&(r[i]=e[i]);return t(r,n)};return r},n=t(r);return n.get=t(r.get),n.post=t(r.post),n.put=t(r.put),n.head=t(r.head),n};var f=["get","put","post","head"];f.forEach(function(e){var t=e.toUpperCase(),n=e.toLowerCase();r[n]=function(e){"string"==typeof e?e={method:t,uri:e}:(e=JSON.parse(JSON.stringify(e)),e.method=t);var n=[e].concat(Array.prototype.slice.apply(arguments,[1]));return r.apply(this,n)}}),r.couch=function(e,t){function n(e,r,n){if(e)return t(e,r,n);if((r.statusCode<200||r.statusCode>299)&&n.error){e=new Error("CouchDB error: "+(n.error.reason||n.error.error));for(var i in n)e[i]=n[i];return t(e,r,n)}return t(e,r,n)}"string"==typeof e&&(e={uri:e}),e.json=!0,e.body&&(e.json=e.body),delete e.body,t=t||i;var o=r(e,n);return o},t.exports=r},{}],61:[function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,i,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],s(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,a=new Array(i-1),u=1;i>u;u++)a[u-1]=arguments[u];r.apply(this,a)}else if(o(r)){for(i=arguments.length,a=new Array(i-1),u=1;i>u;u++)a[u-1]=arguments[u];for(c=r.slice(),i=c.length,u=0;i>u;u++)c[u].apply(this,a)}return!0},r.prototype.addListener=function(e,t){var i;if(!n(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var i;i=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var r,i,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,i=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-->0;)if(r[a]===t||r[a].listener&&r[a].listener===t){i=a;break}if(0>i)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?n(e._events[t])?1:e._events[t].length:0}},{}],62:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],63:[function(e,t){function r(){}var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var r=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),r.length>0)){var n=r.shift();n()}},!0),function(e){r.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=r,n.addListener=r,n.once=r,n.off=r,n.removeListener=r,n.removeAllListeners=r,n.emit=r,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],64:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],65:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),_(t)?n.showHidden=t:t&&r._extend(n,t),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),u(n,e,n.depth)}function o(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function s(e){return e}function a(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function u(e,t,n){if(e.customInspect&&t&&A(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return m(i)||(i=u(e,i,n)),i}var o=c(e,t);if(o)return o;var s=Object.keys(t),_=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),C(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(t);if(0===s.length){if(A(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(j(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(C(t))return h(t)}var y="",g=!1,E=["{","}"];if(p(t)&&(g=!0,E=["[","]"]),A(t)){var b=t.name?": "+t.name:"";y=" [Function"+b+"]"}if(j(t)&&(y=" "+RegExp.prototype.toString.call(t)),w(t)&&(y=" "+Date.prototype.toUTCString.call(t)),C(t)&&(y=" "+h(t)),0===s.length&&(!g||0==t.length))return E[0]+y+E[1];if(0>n)return j(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var T;return T=g?l(e,t,n,_,s):s.map(function(r){return f(e,t,n,_,r,g)}),e.seen.pop(),d(T,y,E)}function c(e,t){if(b(t))return e.stylize("undefined","undefined");if(m(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return g(t)?e.stylize(""+t,"number"):_(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,r,n,i){for(var o=[],s=0,a=t.length;a>s;++s)o.push(O(t,String(s))?f(e,t,r,n,String(s),!0):"");return i.forEach(function(i){i.match(/^\d+$/)||o.push(f(e,t,r,n,i,!0))}),o}function f(e,t,r,n,i,o){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),O(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=v(r)?u(e,c.value,null):u(e,c.value,r-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),b(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function d(e,t,r){var n=0,i=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function p(e){return Array.isArray(e)}function _(e){return"boolean"==typeof e}function v(e){return null===e}function y(e){return null==e}function g(e){return"number"==typeof e}function m(e){return"string"==typeof e}function E(e){return"symbol"==typeof e}function b(e){return void 0===e}function j(e){return T(e)&&"[object RegExp]"===R(e)}function T(e){return"object"==typeof e&&null!==e}function w(e){return T(e)&&"[object Date]"===R(e)}function C(e){return T(e)&&("[object Error]"===R(e)||e instanceof Error)}function A(e){return"function"==typeof e}function S(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function R(e){return Object.prototype.toString.call(e)}function F(e){return 10>e?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[F(e.getHours()),F(e.getMinutes()),F(e.getSeconds())].join(":");return[e.getDate(),x[e.getMonth()],t].join(" ")}function O(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var N=/%[sdj%]/g;r.format=function(e){if(!m(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,s=String(e).replace(N,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return e}}),a=n[r];o>r;a=n[++r])s+=v(a)||!T(a)?" "+a:" "+i(a);return s},r.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(b(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return o};var I,q={};r.debuglog=function(e){if(b(I)&&(I=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!q[e])if(new RegExp("\\b"+e+"\\b","i").test(I)){var n=t.pid;q[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else q[e]=function(){};return q[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=p,r.isBoolean=_,r.isNull=v,r.isNullOrUndefined=y,r.isNumber=g,r.isString=m,r.isSymbol=E,r.isUndefined=b,r.isRegExp=j,r.isObject=T,r.isDate=w,r.isError=C,r.isFunction=A,r.isPrimitive=S,r.isBuffer=e("./support/isBuffer");var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",P(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!T(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":64,FWaASH:63,inherits:62}],66:[function(_dereq_,module,exports){(function(process,global){!function(){"use strict";var Faye={VERSION:"1.0.3",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(e,t,r){if(!t)return e;for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)&&r===!1||e[n]!==t[n]&&(e[n]=t[n]));return e},random:function(e){return e=e||this.ID_LENGTH,csprng(e,36)},clientIdFromMessages:function(e){var t=this.filter([].concat(e),function(e){return"/meta/connect"===e.channel});return t[0]&&t[0].clientId},copyObject:function(e){var t,r,n;if(e instanceof Array){for(t=[],r=e.length;r--;)t[r]=Faye.copyObject(e[r]);return t}if("object"==typeof e){t=null===e?null:{};for(n in e)t[n]=Faye.copyObject(e[n]);return t}return e},commonElement:function(e,t){for(var r=0,n=e.length;n>r;r++)if(-1!==this.indexOf(t,e[r]))return e[r];return null},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return-1},map:function(e,t,r){if(e.map)return e.map(t,r);var n=[];if(e instanceof Array)for(var i=0,o=e.length;o>i;i++)n.push(t.call(r||null,e[i],i));else for(var s in e)e.hasOwnProperty(s)&&n.push(t.call(r||null,s,e[s]));return n},filter:function(e,t,r){if(e.filter)return e.filter(t,r);for(var n=[],i=0,o=e.length;o>i;i++)t.call(r||null,e[i],i)&&n.push(e[i]);return n},asyncEach:function(e,t,r,n){var i=e.length,o=-1,s=0,a=!1,u=function(){return s-=1,o+=1,o===i?r&&r.call(n):void t(e[o],h)},c=function(){if(!a){for(a=!0;s>0;)u();a=!1}},h=function(){s+=1,c()};h()},toJSON:function(e){return this.stringify?this.stringify(e,function(e,t){return this[e]instanceof Array?this[e]:t}):JSON.stringify(e)}};"undefined"!=typeof module?module.exports=Faye:"undefined"!=typeof window&&(window.Faye=Faye),Faye.Class=function(e,t){"function"!=typeof e&&(t=e,e=Object);var r=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},n=function(){};return n.prototype=e.prototype,r.prototype=new n,Faye.extend(r.prototype,t),r},function(){function e(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0;r<e.length;r++)if(t===e[r])return r;return-1}var t=Faye.EventEmitter=function(){},r="function"==typeof Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.prototype.emit=function(e){if("error"===e&&(!this._events||!this._events.error||r(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0}if(r(t)){for(var n=Array.prototype.slice.call(arguments,1),i=t.slice(),o=0,s=i.length;s>o;o++)i[o].apply(this,n);return!0}return!1},t.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var r=this;return r.on(e,function n(){r.removeListener(e,n),t.apply(this,arguments)}),this},t.prototype.removeListener=function(t,n){if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(r(i)){var o=e(i,n);if(0>o)return this;i.splice(o,1),0==i.length&&delete this._events[t]}else this._events[t]===n&&delete this._events[t];return this},t.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},t.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),r(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}(),Faye.Namespace=Faye.Class({initialize:function(){this._used={}},exists:function(e){return this._used.hasOwnProperty(e)},generate:function(){for(var e=Faye.random();this._used.hasOwnProperty(e);)e=Faye.random();return this._used[e]=e},release:function(e){delete this._used[e]}}),function(){var e,t=setTimeout;e="function"==typeof setImmediate?function(e){setImmediate(e)}:"object"==typeof process&&process.nextTick?function(e){process.nextTick(e)}:function(e){t(e,0)};var r=0,n=1,i=2,o=function(e){return e},s=function(e){throw e},a=function(e){if(this._state=r,this._callbacks=[],this._errbacks=[],"function"==typeof e){var t=this;e(function(e){f(t,e)},function(e){d(t,e)})}};a.prototype.then=function(e,t){var r={},n=this;return r.promise=new a(function(i,o){r.fulfill=i,r.reject=o,u(n,e,r),c(n,t,r)}),r.promise};var u=function(e,t,i){"function"!=typeof t&&(t=o);var s=function(e){h(t,e,i)};e._state===r?e._callbacks.push(s):e._state===n&&s(e._value)},c=function(e,t,n){"function"!=typeof t&&(t=s);var o=function(e){h(t,e,n)};e._state===r?e._errbacks.push(o):e._state===i&&o(e._reason)},h=function(t,r,n){e(function(){l(t,r,n)})},l=function(e,t,r){var n,i,s,a=!1;try{if(n=e(t),i=typeof n,s=null!==n&&("function"===i||"object"===i)&&n.then,n===r.promise)return r.reject(new TypeError("Recursive promise chain detected"));if("function"!=typeof s)return r.fulfill(n);s.call(n,function(e){a||(a=!0,l(o,e,r))},function(e){a||(a=!0,r.reject(e))})}catch(u){if(a)return;a=!0,r.reject(u)}},f=a.fulfill=a.resolve=function(e,t){if(e._state===r){e._state=n,e._value=t,e._errbacks=[];for(var i,o=e._callbacks;i=o.shift();)i(t)}},d=a.reject=function(e,t){if(e._state===r){e._state=i,e._reason=t,e._callbacks=[];for(var n,o=e._errbacks;n=o.shift();)n(t)}};a.defer=e,a.deferred=a.pending=function(){var e={};return e.promise=new a(function(t,r){e.fulfill=e.resolve=t,e.reject=r}),e},a.fulfilled=a.resolved=function(e){return new a(function(t){t(e)})},a.rejected=function(e){return new a(function(t,r){r(e)})},"undefined"==typeof Faye?module.exports=a:Faye.Promise=a}(),Faye.Set=Faye.Class({initialize:function(){this._index={}},add:function(e){var t=void 0!==e.id?e.id:e;return this._index.hasOwnProperty(t)?!1:(this._index[t]=e,!0)},forEach:function(e,t){for(var r in this._index)this._index.hasOwnProperty(r)&&e.call(t,this._index[r])},isEmpty:function(){for(var e in this._index)if(this._index.hasOwnProperty(e))return!1;return!0},member:function(e){for(var t in this._index)if(this._index[t]===e)return!0;return!1},remove:function(e){var t=void 0!==e.id?e.id:e,r=this._index[t];return delete this._index[t],r},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}}),Faye.URI={isURI:function(e){return e&&e.protocol&&e.host&&e.path},isSameOrigin:function(e){var t=Faye.ENV.location;return e.protocol===t.protocol&&e.hostname===t.hostname&&e.port===t.port},parse:function(e){if("string"!=typeof e)return e;var t,r,n,i,o,s,a={},u=function(t,r){e=e.replace(r,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(u("protocol",/^[a-z]+\:/i),u("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=Faye.ENV.location.pathname.replace(/[^\/]*$/,"")+e),u("pathname",/^[^\?#]*/),u("search",/^\?[^#]*/),u("hash",/^#.*/),a.protocol=a.protocol||Faye.ENV.location.protocol,a.host?(a.host=a.host.substr(2),t=a.host.split(":"),a.hostname=t[0],a.port=t[1]||""):(a.host=Faye.ENV.location.host,a.hostname=Faye.ENV.location.hostname,a.port=Faye.ENV.location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,r=a.search.replace(/^\?/,""),n=r?r.split("&"):[],s={},i=0,o=n.length;o>i;i++)t=n[i].split("="),s[decodeURIComponent(t[0]||"")]=decodeURIComponent(t[1]||"");return a.query=s,a.href=this.stringify(a),a},stringify:function(e){var t=e.protocol+"//"+e.hostname;return e.port&&(t+=":"+e.port),t+=e.pathname+this.queryString(e.query)+(e.hash||"")},queryString:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return 0===t.length?"":"?"+t.join("&")}},Faye.Error=Faye.Class({initialize:function(e,t,r){this.code=e,this.params=Array.prototype.slice.call(t),this.message=r},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),Faye.Error.parse=function(e){if(e=e||"",!Faye.Grammar.ERROR.test(e))return new this(null,[],e);var t=e.split(":"),r=parseInt(t[0]),n=t[1].split(","),e=t[2];return new this(r,n,e)},Faye.Error.versionMismatch=function(){return new this(300,arguments,"Version mismatch").toString()},Faye.Error.conntypeMismatch=function(){return new this(301,arguments,"Connection types not supported").toString()},Faye.Error.extMismatch=function(){return new this(302,arguments,"Extension mismatch").toString()},Faye.Error.badRequest=function(){return new this(400,arguments,"Bad request").toString()},Faye.Error.clientUnknown=function(){return new this(401,arguments,"Unknown client").toString()},Faye.Error.parameterMissing=function(){return new this(402,arguments,"Missing required parameter").toString()},Faye.Error.channelForbidden=function(){return new this(403,arguments,"Forbidden channel").toString()},Faye.Error.channelUnknown=function(){return new this(404,arguments,"Unknown channel").toString()},Faye.Error.channelInvalid=function(){return new this(405,arguments,"Invalid channel").toString()},Faye.Error.extUnknown=function(){return new this(406,arguments,"Unknown extension").toString()},Faye.Error.publishFailed=function(){return new this(407,arguments,"Failed to publish").toString()},Faye.Error.serverError=function(){return new this(500,arguments,"Internal server error").toString()},Faye.Deferrable={then:function(e,t){var r=this;return this._promise||(this._promise=new Faye.Promise(function(e,t){r._fulfill=e,r._reject=t})),0===arguments.length?this._promise:this._promise.then(e,t)},callback:function(e,t){return this.then(function(r){e.call(t,r)})},errback:function(e,t){return this.then(null,function(r){e.call(t,r)})},timeout:function(e,t){this.then();var r=this;this._timer=Faye.ENV.setTimeout(function(){r._reject(t)},1e3*e)},setDeferredStatus:function(e,t){this._timer&&Faye.ENV.clearTimeout(this._timer);this.then();"succeeded"===e?this._fulfill(t):"failed"===e?this._reject(t):delete this._promise}},Faye.Publisher={countListeners:function(e){return this.listeners(e).length},bind:function(e,t,r){var n=Array.prototype.slice,i=function(){t.apply(r,n.call(arguments))};return this._listeners=this._listeners||[],this._listeners.push([e,t,r,i]),this.on(e,i)},unbind:function(e,t,r){this._listeners=this._listeners||[];for(var n,i=this._listeners.length;i--;)n=this._listeners[i],n[0]===e&&(!t||n[1]===t&&n[2]===r)&&(this._listeners.splice(i,1),this.removeListener(e,n[3]))}},Faye.extend(Faye.Publisher,Faye.EventEmitter.prototype),Faye.Publisher.trigger=Faye.Publisher.emit,Faye.Timeouts={addTimeout:function(e,t,r,n){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var i=this;this._timeouts[e]=Faye.ENV.setTimeout(function(){delete i._timeouts[e],r.call(n)},1e3*t)}},removeTimeout:function(e){this._timeouts=this._timeouts||{};var t=this._timeouts[e];t&&(clearTimeout(t),delete this._timeouts[e])},removeAllTimeouts:function(){this._timeouts=this._timeouts||{};for(var e in this._timeouts)this.removeTimeout(e)}},Faye.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,t){if(Faye.logger){var e=Array.prototype.slice.apply(e),r="[Faye",n=this.className,i=e.shift().replace(/\?/g,function(){try{return Faye.toJSON(e.shift())}catch(t){return"[Object]"}});for(var o in Faye)n||"function"==typeof Faye[o]&&this instanceof Faye[o]&&(n=o);n&&(r+="."+n),r+="] ","function"==typeof Faye.logger[t]?Faye.logger[t](r+i):"function"==typeof Faye.logger&&Faye.logger(r+i)}}},function(){for(var e in Faye.Logging.LOG_LEVELS)(function(e){Faye.Logging[e]=function(){this.writeLog(arguments,e)}})(e,Faye.Logging.LOG_LEVELS[e])}(),Faye.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},Faye.Extensible={addExtension:function(e){this._extensions=this._extensions||[],this._extensions.push(e),e.added&&e.added(this)
},removeExtension:function(e){if(this._extensions)for(var t=this._extensions.length;t--;)this._extensions[t]===e&&(this._extensions.splice(t,1),e.removed&&e.removed(this))},pipeThroughExtensions:function(e,t,r,n,i){if(this.debug("Passing through ? extensions: ?",e,t),!this._extensions)return n.call(i,t);var o=this._extensions.slice(),s=function(t){if(!t)return n.call(i,t);var a=o.shift();if(!a)return n.call(i,t);var u=a[e];return u?void(u.length>=3?a[e](t,r,s):a[e](t,s)):s(t)};s(t)}},Faye.extend(Faye.Extensible,Faye.Logging),Faye.Channel=Faye.Class({initialize:function(e){this.id=this.name=e},push:function(e){this.trigger("message",e)},isUnused:function(){return 0===this.countListeners("message")}}),Faye.extend(Faye.Channel.prototype,Faye.Publisher),Faye.extend(Faye.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(e){var t=this.parse(e),r=["/**",e],n=t.slice();n[n.length-1]="*",r.push(this.unparse(n));for(var i=1,o=t.length;o>i;i++)n=t.slice(0,i),n.push("**"),r.push(this.unparse(n));return r},isValid:function(e){return Faye.Grammar.CHANNEL_NAME.test(e)||Faye.Grammar.CHANNEL_PATTERN.test(e)},parse:function(e){return this.isValid(e)?e.split("/").slice(1):null},unparse:function(e){return"/"+e.join("/")},isMeta:function(e){var t=this.parse(e);return t?t[0]===this.META:null},isService:function(e){var t=this.parse(e);return t?t[0]===this.SERVICE:null},isSubscribable:function(e){return this.isValid(e)?!this.isMeta(e)&&!this.isService(e):null},Set:Faye.Class({initialize:function(){this._channels={}},getKeys:function(){var e=[];for(var t in this._channels)e.push(t);return e},remove:function(e){delete this._channels[e]},hasSubscription:function(e){return this._channels.hasOwnProperty(e)},subscribe:function(e,t,r){if(t)for(var n,i=0,o=e.length;o>i;i++){n=e[i];var s=this._channels[n]=this._channels[n]||new Faye.Channel(n);s.bind("message",t,r)}},unsubscribe:function(e,t,r){var n=this._channels[e];return n?(n.unbind("message",t,r),n.isUnused()?(this.remove(e),!0):!1):!1},distributeMessage:function(e){for(var t=Faye.Channel.expand(e.channel),r=0,n=t.length;n>r;r++){var i=this._channels[t[r]];i&&i.trigger("message",e.data)}}})}),Faye.Envelope=Faye.Class({initialize:function(e,t){this.id=e.id,this.message=e,void 0!==t&&this.timeout(t/1e3,!1)}}),Faye.extend(Faye.Envelope.prototype,Faye.Deferrable),Faye.Publication=Faye.Class(Faye.Deferrable),Faye.Subscription=Faye.Class({initialize:function(e,t,r,n){this._client=e,this._channels=t,this._callback=r,this._context=n,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),Faye.extend(Faye.Subscription.prototype,Faye.Deferrable),Faye.Client=Faye.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_RETRY:5,MAX_REQUEST_SIZE:2048,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,t){this.info("New client created for ?",e),this._options=t||{},this.endpoint=Faye.URI.parse(e||this.DEFAULT_ENDPOINT),this.endpoints=this._options.endpoints||{},this.transports={},this.cookies=Faye.CookieJar&&new Faye.CookieJar,this.headers={},this.ca=this._options.ca,this._disabled=[],this._retry=this._options.retry||this.DEFAULT_RETRY;for(var r in this.endpoints)this.endpoints[r]=Faye.URI.parse(this.endpoints[r]);this.maxRequestSize=this.MAX_REQUEST_SIZE,this._state=this.UNCONNECTED,this._channels=new Faye.Channel.Set,this._messageId=0,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(this._options.interval||this.INTERVAL),timeout:1e3*(this._options.timeout||this.CONNECTION_TIMEOUT)},Faye.Event&&void 0!==Faye.ENV.onbeforeunload&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.indexOf(this._disabled,"autodisconnect")<0&&this.disconnect()},this)},disable:function(e){this._disabled.push(e)},setHeader:function(e,t){this.headers[e]=t},handshake:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var r=this;this.info("Initiating handshake with ?",Faye.URI.stringify(this.endpoint)),this._selectTransport(Faye.MANDATORY_CONNECTION_TYPES),this._send({channel:Faye.Channel.HANDSHAKE,version:Faye.BAYEUX_VERSION,supportedConnectionTypes:[this._transport.connectionType]},function(n){n.successful?(this._state=this.CONNECTED,this._clientId=n.clientId,this._selectTransport(n.supportedConnectionTypes),this.info("Handshake successful: ?",this._clientId),this.subscribe(this._channels.getKeys(),!0),e&&Faye.Promise.defer(function(){e.call(t)})):(this.info("Handshake unsuccessful"),Faye.ENV.setTimeout(function(){r.handshake(e,t)},this._advice.interval),this._state=this.UNCONNECTED)},this)}},connect:function(e,t){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,t)},this);this.callback(e,t),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("unknown"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._clientId),this._send({channel:Faye.Channel.CONNECT,clientId:this._clientId,connectionType:this._transport.connectionType},this._cycleConnection,this)))}},disconnect:function(){this._state===this.CONNECTED&&(this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._clientId),this._send({channel:Faye.Channel.DISCONNECT,clientId:this._clientId},function(e){e.successful&&(this._transport.close(),delete this._transport)},this),this.info("Clearing channel listeners for ?",this._clientId),this._channels=new Faye.Channel.Set)},subscribe:function(e,t,r){if(e instanceof Array)return Faye.map(e,function(e){return this.subscribe(e,t,r)},this);var n=new Faye.Subscription(this,e,t,r),i=t===!0,o=this._channels.hasSubscription(e);return o&&!i?(this._channels.subscribe([e],t,r),n.setDeferredStatus("succeeded"),n):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._clientId,e),i||this._channels.subscribe([e],t,r),this._send({channel:Faye.Channel.SUBSCRIBE,clientId:this._clientId,subscription:e},function(i){if(!i.successful)return n.setDeferredStatus("failed",Faye.Error.parse(i.error)),this._channels.unsubscribe(e,t,r);var o=[].concat(i.subscription);this.info("Subscription acknowledged for ? to ?",this._clientId,o),n.setDeferredStatus("succeeded")},this)},this),n)},unsubscribe:function(e,t,r){if(e instanceof Array)return Faye.map(e,function(e){return this.unsubscribe(e,t,r)},this);var n=this._channels.unsubscribe(e,t,r);n&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._clientId,e),this._send({channel:Faye.Channel.UNSUBSCRIBE,clientId:this._clientId,subscription:e},function(e){if(e.successful){var t=[].concat(e.subscription);this.info("Unsubscription acknowledged for ? from ?",this._clientId,t)}},this)},this)},publish:function(e,t){var r=new Faye.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._clientId,e,t),this._send({channel:e,data:t,clientId:this._clientId},function(e){e.successful?r.setDeferredStatus("succeeded"):r.setDeferredStatus("failed",Faye.Error.parse(e.error))},this)},this),r},receiveMessage:function(e){var t,r=e.id;void 0!==e.successful&&(t=this._responseCallbacks[r],delete this._responseCallbacks[r]),this.pipeThroughExtensions("incoming",e,null,function(e){e&&(e.advice&&this._handleAdvice(e.advice),this._deliverMessage(e),t&&t[0].call(t[1],e))},this),this._transportUp!==!0&&(this._transportUp=!0,this.trigger("transport:up"))},messageError:function(e,t){for(var r,n,i=this._retry,o=this,s=0,a=e.length;a>s;s++)n=e[s],r=n.id,t?this._transportSend(n):Faye.ENV.setTimeout(function(){o._transportSend(n)},1e3*i);t||this._transportUp===!1||(this._transportUp=!1,this.trigger("transport:down"))},_selectTransport:function(e){Faye.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,Faye.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e)},this)},_send:function(e,t,r){this._transport&&(e.id=e.id||this._generateMessageId(),this.pipeThroughExtensions("outgoing",e,null,function(e){e&&(t&&(this._responseCallbacks[e.id]=[t,r]),this._transportSend(e))},this))},_transportSend:function(e){if(this._transport){var t=1.2*(this._advice.timeout||1e3*this._retry),r=new Faye.Envelope(e,t);r.errback(function(t){this.messageError([e],t)},this),this._transport.send(r)}},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_handleAdvice:function(e){Faye.extend(this._advice,e),this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._clientId=null,this._cycleConnection())},_deliverMessage:function(e){e.channel&&void 0!==e.data&&(this.info("Client ? calling listeners for ? with ?",this._clientId,e.channel,e.data),this._channels.distributeMessage(e))},_cycleConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._clientId));var e=this;Faye.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),Faye.extend(Faye.Client.prototype,Faye.Deferrable),Faye.extend(Faye.Client.prototype,Faye.Publisher),Faye.extend(Faye.Client.prototype,Faye.Logging),Faye.extend(Faye.Client.prototype,Faye.Extensible),Faye.Transport=Faye.extend(Faye.Class({MAX_DELAY:0,batching:!0,initialize:function(e,t){this._client=e,this.endpoint=t,this._outbox=[]},close:function(){},encode:function(){return""},send:function(e){var t=e.message;return this.debug("Client ? sending message to ?: ?",this._client._clientId,Faye.URI.stringify(this.endpoint),t),this.batching?(this._outbox.push(e),t.channel===Faye.Channel.HANDSHAKE?this.addTimeout("publish",.01,this.flush,this):(t.channel===Faye.Channel.CONNECT&&(this._connectMessage=t),this.flushLargeBatch(),void this.addTimeout("publish",this.MAX_DELAY,this.flush,this))):this.request([e])},flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this.request(this._outbox),this._connectMessage=null,this._outbox=[]},flushLargeBatch:function(){var e=this.encode(this._outbox);if(!(e.length<this._client.maxRequestSize)){var t=this._outbox.pop();this.flush(),t&&this._outbox.push(t)}},receive:function(e,t){for(var r=e.length;r--;)e[r].setDeferredStatus("succeeded");t=[].concat(t),this.debug("Client ? received from ?: ?",this._client._clientId,Faye.URI.stringify(this.endpoint),t);for(var n=0,r=t.length;r>n;n++)this._client.receiveMessage(t[n])},handleError:function(e,t){for(var r=e.length;r--;)e[r].setDeferredStatus("failed",t)},_getCookies:function(){var e=this._client.cookies;return e?e.getCookies({domain:this.endpoint.hostname,path:this.endpoint.path,secure:"https:"===this.endpoint.protocol}).toValueString():""},_storeCookies:function(e){if(e&&this._client.cookies){e=[].concat(e);for(var t,r=0,n=e.length;n>r;r++)t=this._client.cookies.setCookie(e[r]),t=t[0]||t,t.domain=t.domain||this.endpoint.hostname}}}),{get:function(e,t,r,n,i){var o=e.endpoint;Faye.asyncEach(this._transports,function(s,a){var u=s[0],c=s[1],h=e.endpoints[u]||o;return Faye.indexOf(r,u)>=0?a():Faye.indexOf(t,u)<0?(c.isUsable(e,h,function(){}),a()):void c.isUsable(e,h,function(t){if(!t)return a();var r=c.hasOwnProperty("create")?c.create(e,h):new c(e,h);n.call(i,r)})},function(){throw new Error("Could not find a usable connection type for "+Faye.URI.stringify(o))})},register:function(e,t){this._transports.push([e,t]),t.prototype.connectionType=e},_transports:[]}),Faye.extend(Faye.Transport.prototype,Faye.Logging),Faye.extend(Faye.Transport.prototype,Faye.Timeouts),Faye.Event={_registry:[],on:function(e,t,r,n){var i=function(){r.call(n)};e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i),this._registry.push({_element:e,_type:t,_callback:r,_context:n,_handler:i})},detach:function(e,t,r,n){for(var i,o=this._registry.length;o--;)i=this._registry[o],e&&e!==i._element||t&&t!==i._type||r&&r!==i._callback||n&&n!==i._context||(i._element.removeEventListener?i._element.removeEventListener(i._type,i._handler,!1):i._element.detachEvent("on"+i._type,i._handler),this._registry.splice(o,1),i=null)}},void 0!==Faye.ENV.onunload&&Faye.Event.on(Faye.ENV,"unload",Faye.Event.detach,Faye.Event),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,i,o,s,a=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,r=0;o>r;r+=1)s[r]=str(r,u)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;o>r;r+=1)"string"==typeof rep[r]&&(n=rep[r],i=str(n,u),i&&s.push(quote(n)+(gap?": ":":")+i));else for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(i=str(n,u),i&&s.push(quote(n)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;Faye.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},"function"!=typeof JSON.stringify&&(JSON.stringify=Faye.stringify),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,n,i=e[t];if(i&&"object"==typeof i)for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n=walk(i,r),void 0!==n?i[r]=n:delete i[r]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),Faye.Transport.WebSocket=Faye.extend(Faye.Class(Faye.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)}),this.connect()},request:function(e){this._pending=this._pending||new Faye.Set;for(var t=0,r=e.length;r>t;t++)this._pending.add(e[t]);this.callback(function(t){if(t){var r=Faye.map(e,function(e){return e.message});t.send(Faye.toJSON(r))}},this),this.connect()},connect:function(){if(!Faye.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=this._createSocket();if(!e)return this.setDeferredStatus("failed");var t=this;e.onopen=function(){e.headers&&t._storeCookies(e.headers["set-cookie"]),t._socket=e,t._state=t.CONNECTED,t._everConnected=!0,t._ping(),t.setDeferredStatus("succeeded",e)};var r=!1;e.onclose=e.onerror=function(){if(!r){r=!0;var n=t._state===t.CONNECTED;e.onopen=e.onclose=e.onerror=e.onmessage=null,delete t._socket,t._state=t.UNCONNECTED,t.removeTimeout("ping"),t.setDeferredStatus("unknown");var i=t._pending?t._pending.toArray():[];delete t._pending,n?t.handleError(i,!0):t._everConnected?t.handleError(i):t.setDeferredStatus("failed")}},e.onmessage=function(e){var r,n=JSON.parse(e.data),i=[];if(n){n=[].concat(n);for(var o=0,s=n.length;s>o;o++)void 0!==n[o].successful&&(r=t._pending.remove(n[o]),r&&i.push(r));t.receive(i,n)}}}},close:function(){this._socket&&this._socket.close()},_createSocket:function(){var e=Faye.Transport.WebSocket.getSocketUrl(this.endpoint),t={headers:Faye.copyObject(this._client.headers),ca:this._client.ca};return t.headers.Cookie=this._getCookies(),Faye.WebSocket?new Faye.WebSocket.Client(e,[],t):Faye.ENV.MozWebSocket?new MozWebSocket(e):Faye.ENV.WebSocket?new WebSocket(e):void 0},_ping:function(){this._socket&&(this._socket.send("[]"),this.addTimeout("ping",this._client._advice.timeout/2e3,this._ping,this))}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},create:function(e,t){var r=e.transports.websocket=e.transports.websocket||{};return r[t.href]=r[t.href]||new this(e,t),r[t.href]},getSocketUrl:function(e){return e=Faye.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],Faye.URI.stringify(e)},isUsable:function(e,t,r,n){this.create(e,t).isUsable(r,n)}}),Faye.extend(Faye.Transport.WebSocket.prototype,Faye.Deferrable),Faye.Transport.register("websocket",Faye.Transport.WebSocket),Faye.Event&&Faye.Event.on(Faye.ENV,"beforeunload",function(){Faye.Transport.WebSocket._unloaded=!0}),Faye.Transport.EventSource=Faye.extend(Faye.Class(Faye.Transport,{initialize:function(e,t){if(Faye.Transport.prototype.initialize.call(this,e,t),!Faye.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new Faye.Transport.XHR(e,t),t=Faye.copyObject(t),t.pathname+="/"+e._clientId;var r=new EventSource(Faye.URI.stringify(t)),n=this;r.onopen=function(){n._everConnected=!0,n.setDeferredStatus("succeeded")},r.onerror=function(){n._everConnected?n._client.messageError([]):(n.setDeferredStatus("failed"),r.close())},r.onmessage=function(e){n.receive([],JSON.parse(e.data))},this._socket=r},close:function(){this._socket&&(this._socket.onopen=this._socket.onerror=this._socket.onmessage=null,this._socket.close(),delete this._socket)},isUsable:function(e,t){this.callback(function(){e.call(t,!0)}),this.errback(function(){e.call(t,!1)})},encode:function(e){return this._xhr.encode(e)},request:function(e){this._xhr.request(e)}}),{isUsable:function(e,t,r,n){var i=e._clientId;return i?void Faye.Transport.XHR.isUsable(e,t,function(i){return i?void this.create(e,t).isUsable(r,n):r.call(n,!1)},this):r.call(n,!1)},create:function(e,t){var r=e.transports.eventsource=e.transports.eventsource||{},n=e._clientId;t=Faye.copyObject(t),t.pathname+="/"+(n||"");var i=Faye.URI.stringify(t);return r[i]=r[i]||new this(e,t),r[i]}}),Faye.extend(Faye.Transport.EventSource.prototype,Faye.Deferrable),Faye.Transport.register("eventsource",Faye.Transport.EventSource),Faye.Transport.XHR=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message});return Faye.toJSON(t)},request:function(e){var t=this.endpoint.path,r=Faye.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,n=this;r.open("POST",t,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Pragma","no-cache"),r.setRequestHeader("X-Requested-With","XMLHttpRequest");var i=this._client.headers;for(var o in i)i.hasOwnProperty(o)&&r.setRequestHeader(o,i[o]);var s=function(){r.abort()};Faye.Event.on(Faye.ENV,"beforeunload",s),r.onreadystatechange=function(){if(r&&4===r.readyState){var t=null,i=r.status,o=r.responseText,a=i>=200&&300>i||304===i||1223===i;if(Faye.Event.detach(Faye.ENV,"beforeunload",s),r.onreadystatechange=function(){},r=null,!a)return n.handleError(e);try{t=JSON.parse(o)}catch(u){}t?n.receive(e,t):n.handleError(e)}},r.send(this.encode(e))}}),{isUsable:function(e,t,r,n){r.call(n,Faye.URI.isSameOrigin(t))}}),Faye.Transport.register("long-polling",Faye.Transport.XHR),Faye.Transport.CORS=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message});return"message="+encodeURIComponent(Faye.toJSON(t))},request:function(e){var t,r=Faye.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,n=new r,i=this._client.headers,o=this;if(n.open("POST",Faye.URI.stringify(this.endpoint),!0),n.setRequestHeader){n.setRequestHeader("Pragma","no-cache");for(t in i)i.hasOwnProperty(t)&&n.setRequestHeader(t,i[t])}var s=function(){return n?(n.onload=n.onerror=n.ontimeout=n.onprogress=null,void(n=null)):!1};n.onload=function(){var t=null;try{t=JSON.parse(n.responseText)}catch(r){}s(),t?o.receive(e,t):o.handleError(e)},n.onerror=n.ontimeout=function(){s(),o.handleError(e)},n.onprogress=function(){},n.send(this.encode(e))}}),{isUsable:function(e,t,r,n){if(Faye.URI.isSameOrigin(t))return r.call(n,!1);if(Faye.ENV.XDomainRequest)return r.call(n,t.protocol===Faye.ENV.location.protocol);if(Faye.ENV.XMLHttpRequest){var i=new Faye.ENV.XMLHttpRequest;return r.call(n,void 0!==i.withCredentials)}return r.call(n,!1)}}),Faye.Transport.register("cross-origin-long-polling",Faye.Transport.CORS),Faye.Transport.JSONP=Faye.extend(Faye.Class(Faye.Transport,{encode:function(e){var t=Faye.map(e,function(e){return e.message}),r=Faye.copyObject(this.endpoint);return r.query.message=Faye.toJSON(t),r.query.jsonp="__jsonp"+Faye.Transport.JSONP._cbCount+"__",Faye.URI.stringify(r)},request:function(e){var t=Faye.map(e,function(e){return e.message}),r=document.getElementsByTagName("head")[0],n=document.createElement("script"),i=Faye.Transport.JSONP.getCallbackName(),o=Faye.copyObject(this.endpoint),s=this;o.query.message=Faye.toJSON(t),o.query.jsonp=i,Faye.ENV[i]=function(t){if(!Faye.ENV[i])return!1;Faye.ENV[i]=void 0;try{delete Faye.ENV[i]}catch(r){}n.parentNode.removeChild(n),s.receive(e,t)},n.type="text/javascript",n.src=Faye.URI.stringify(o),r.appendChild(n)}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(e,t,r,n){r.call(n,!0)}}),Faye.Transport.register("callback-polling",Faye.Transport.JSONP)}()}).call(this,_dereq_("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{FWaASH:63}],67:[function(e,t){t.exports=function(){function t(e,t){if(!e)throw new TypeError("A Robin Access Token must be supplied");var o=i.buildRobinUrls(t);this.api=new r(e,o.core,o.places),this.grid=new n(e,o.grid)}var r=e("./lib/api"),n=e("./lib/grid"),i=e("./lib/util");return t.prototype.setRelayIdentifier=function(e){this.api.setRelayIdentifier(e),this.grid.setRelayIdentifier(e)},t}.call(this)},{"./lib/api":3,"./lib/grid":21,"./lib/util":24}]},{},[67])(67)});